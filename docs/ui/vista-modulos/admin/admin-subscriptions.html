<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gesti√≥n de Suscripciones | Admin Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --admin-primary: #f59e0b;
      --admin-secondary: #d97706;
      --admin-accent: #fbbf24;
      --admin-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      --admin-glow: 0 0 20px rgba(245, 158, 11, 0.4);
      --status-healthy: #00FF94;
      --status-warn: #FFD700;
      --status-degraded: #FF8C00;
      --status-down: #FF4444;
      --status-critical: #CC0000;
      --primary-cyan: #00F5FF;
      --primary-green: #00FF94;
      --primary-blue: #0066FF;
      --secondary-gold: #FFD700;
      --secondary-red: #FF4444;
      --secondary-orange: #FF8C00;
      --bg-primary: #0A0A1A;
      --bg-secondary: #141428;
      --bg-tertiary: #1E1E38;
      --bg-elevated: #252545;
      --border-primary: #2A2A4A;
      --border-secondary: #3A3A5A;
      --text-primary: #FFFFFF;
      --text-secondary: #B8B8D0;
      --text-muted: #8888A8;
      --sidebar-width: 280px;
    }

    body {
      font-family: 'Rajdhani', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: 
        linear-gradient(var(--border-primary) 1px, transparent 1px),
        linear-gradient(90deg, var(--border-primary) 1px, transparent 1px);
      background-size: 50px 50px;
      opacity: 0.15;
      z-index: 0;
      pointer-events: none;
    }

    .dashboard {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }

    /* SIDEBAR */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-primary);
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
      overflow-y: auto;
    }

    .sidebar-logo {
      padding: 20px;
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      align-items: center;
      gap: 12px;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(217, 119, 6, 0.08));
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--admin-gradient);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      box-shadow: var(--admin-glow);
    }

    .logo-text {
      font-size: 18px;
      font-weight: 700;
      background: var(--admin-gradient);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .sidebar-nav {
      flex: 1;
      padding: 12px 8px;
    }

    .nav-section {
      margin-bottom: 20px;
    }

    .nav-section-title {
      padding: 6px 12px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      margin-bottom: 6px;
      border-radius: 10px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
      border-left: 3px solid transparent;
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(217, 119, 6, 0.15));
      color: var(--admin-primary);
      border-left-color: var(--admin-primary);
      box-shadow: 0 0 20px rgba(245, 158, 11, 0.2);
    }

    .nav-icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    /* MAIN CONTENT */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* HEADER */
    .header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-primary);
      padding: 24px 32px;
      position: sticky;
      top: 0;
      z-index: 90;
      backdrop-filter: blur(12px);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .header-title {
      font-size: 28px;
      font-weight: 700;
      background: var(--admin-gradient);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 4px;
    }

    .header-subtitle {
      font-size: 14px;
      color: var(--text-muted);
    }

    .header-controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .date-range-controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .date-input {
      width: 140px;
      padding: 8px 12px;
      font-size: 14px;
    }

    /* Top Controls */
    .top-controls {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-primary);
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 24px;
    }

    .search-section {
      display: flex;
      gap: 12px;
      align-items: center;
      flex: 1;
      max-width: 500px;
    }

    .search-section .search-input {
      flex: 1;
      margin: 0;
    }

    .quick-filters {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .quick-filters .form-select {
      width: 160px;
      padding: 8px 12px;
      font-size: 14px;
    }

    .search-input {
      flex: 1;
      min-width: 300px;
      padding: 10px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: 'Rajdhani', sans-serif;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--admin-primary);
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
    }

    .filter-btns {
      display: flex;
      gap: 8px;
    }

    .filter-btn {
      padding: 10px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Rajdhani', sans-serif;
    }

    .filter-btn.active {
      background: var(--admin-gradient);
      color: white;
      border-color: transparent;
      box-shadow: var(--admin-glow);
    }

    .filter-btn:hover:not(.active) {
      border-color: var(--admin-primary);
      color: var(--admin-primary);
    }

    .btn {
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Rajdhani', sans-serif;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--admin-gradient);
      color: white;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.5);
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--border-primary);
      color: var(--text-secondary);
    }

    .btn-outline:hover {
      border-color: var(--admin-primary);
      color: var(--admin-primary);
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    .btn-danger {
      background: linear-gradient(135deg, #FF4444 0%, #CC0000 100%);
      color: white;
    }

    .btn-success {
      background: linear-gradient(135deg, #00FF94 0%, #00D970 100%);
      color: var(--bg-primary);
    }

    /* STATUS BADGES */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      white-space: nowrap;
    }

    .badge.active { background: rgba(0, 255, 148, 0.15); color: var(--status-healthy); }
    .badge.pending { background: rgba(255, 215, 0, 0.15); color: var(--status-warn); }
    .badge.expired { background: rgba(255, 68, 68, 0.15); color: var(--secondary-red); }
    .badge.canceled { background: rgba(136, 136, 168, 0.15); color: var(--text-muted); }
    .badge.confirmed { background: rgba(0, 255, 148, 0.15); color: var(--status-healthy); }
    .badge.failed { background: rgba(255, 68, 68, 0.15); color: var(--secondary-red); }
    .badge.draft { background: rgba(255, 140, 0, 0.15); color: var(--status-degraded); }
    .badge.archived { background: rgba(136, 136, 168, 0.15); color: var(--text-muted); }

    .badge.global { background: rgba(0, 245, 255, 0.15); color: var(--primary-cyan); }
    .badge.tipster { background: rgba(245, 158, 11, 0.15); color: var(--admin-primary); }

    /* CONTENT AREA */
    .content-area {
      flex: 1;
      padding: 32px;
      overflow-y: auto;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* TABS */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 1px solid var(--border-primary);
    }

    .tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Rajdhani', sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .tab.active {
      color: var(--admin-primary);
      border-bottom-color: var(--admin-primary);
    }

    .tab:hover:not(.active) {
      color: var(--text-primary);
    }

    /* KPI GRID */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .kpi-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: 14px;
      padding: 24px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .kpi-card:hover {
      border-color: var(--admin-primary);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(245, 158, 11, 0.2);
    }

    .kpi-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .kpi-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(217, 119, 6, 0.15));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .kpi-label {
      font-size: 13px;
      color: var(--text-muted);
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .kpi-value {
      font-size: 32px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .kpi-delta {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      font-weight: 600;
    }

    .kpi-delta.positive {
      color: var(--status-healthy);
    }

    .kpi-delta.negative {
      color: var(--secondary-red);
    }

    /* TABLE CONTAINER */
    .table-container {
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: 14px;
      overflow: hidden;
      margin-bottom: 24px;
    }

    .table-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-primary);
      background: var(--bg-tertiary);
    }

    .table-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .table-actions {
      display: flex;
      gap: 12px;
    }

    /* DATA TABLE */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1200px;
    }

    .data-table thead {
      background: var(--bg-tertiary);
    }

    .data-table th {
      padding: 16px 12px;
      text-align: left;
      font-size: 11px;
      color: var(--text-muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid var(--border-primary);
      cursor: pointer;
    }

    .data-table th:hover {
      color: var(--admin-primary);
    }

    .data-table td {
      padding: 16px 12px;
      font-size: 14px;
      border-bottom: 1px solid var(--border-primary);
    }

    .data-table tbody tr {
      transition: background 0.2s ease;
      cursor: pointer;
    }

    .data-table tbody tr:hover {
      background: var(--bg-tertiary);
    }

    /* USER CELL */
    .user-cell {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: var(--admin-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
    }

    .user-info {
      display: flex;
      flex-direction: column;
    }

    .user-name {
      font-weight: 600;
      color: var(--text-primary);
    }

    .user-email {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* FEATURE CHIPS */
    .feature-chips {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .feature-chip {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 600;
      background: rgba(245, 158, 11, 0.15);
      color: var(--admin-primary);
    }

    /* LIMITS CELL */
    .limits-text {
      font-size: 12px;
      color: var(--text-secondary);
      font-family: 'JetBrains Mono', monospace;
    }

    /* ACTION BUTTONS */
    .action-btn {
      padding: 6px 10px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-primary);
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-right: 6px;
    }

    .action-btn:hover {
      border-color: var(--admin-primary);
      color: var(--admin-primary);
    }

    .action-btn.primary {
      background: var(--admin-gradient);
      color: white;
      border-color: transparent;
    }

    .action-btn.danger {
      background: rgba(255, 68, 68, 0.15);
      color: var(--secondary-red);
      border-color: rgba(255, 68, 68, 0.3);
    }

    /* USAGE INFO */
    .usage-info {
      padding: 16px 24px;
      background: var(--bg-tertiary);
      border-top: 1px solid var(--border-primary);
      font-size: 12px;
      color: var(--text-muted);
    }

    .usage-info p {
      margin: 4px 0;
    }

    /* BADGES */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge.active {
      background: rgba(0, 255, 148, 0.15);
      color: var(--status-healthy);
      border: 1px solid rgba(0, 255, 148, 0.3);
    }

    .badge.warning {
      background: rgba(255, 215, 0, 0.15);
      color: var(--status-warn);
      border: 1px solid rgba(255, 215, 0, 0.3);
    }

    /* STATUS CHIPS */
    .status-chips {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid;
    }

    .chip.healthy {
      background: rgba(0, 255, 148, 0.1);
      border-color: rgba(0, 255, 148, 0.3);
      color: var(--status-healthy);
    }

    .chip.warn {
      background: rgba(255, 215, 0, 0.1);
      border-color: rgba(255, 215, 0, 0.3);
      color: var(--status-warn);
    }

    .chip.degraded {
      background: rgba(255, 140, 0, 0.1);
      border-color: rgba(255, 140, 0, 0.3);
      color: var(--status-degraded);
    }

    .chip.down {
      background: rgba(255, 68, 68, 0.1);
      border-color: rgba(255, 68, 68, 0.3);
      color: var(--status-down);
    }

    .chip-badge {
      background: rgba(255, 255, 255, 0.2);
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 700;
    }

    /* DRAWER */
    .drawer-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      z-index: 200;
    }

    .drawer-overlay.active {
      display: block;
    }

    .drawer {
      position: fixed;
      right: 0;
      top: 0;
      bottom: 0;
      width: 700px;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border-primary);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      overflow-y: auto;
      z-index: 201;
    }

    .drawer.active {
      transform: translateX(0);
    }

    .drawer-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--bg-tertiary);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .drawer-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .drawer-close {
      width: 36px;
      height: 36px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      color: var(--text-muted);
    }

    .drawer-close:hover {
      color: var(--text-primary);
      border-color: var(--admin-primary);
    }

    .drawer-tabs {
      display: flex;
      gap: 4px;
      padding: 20px 24px 0;
      border-bottom: 1px solid var(--border-primary);
      overflow-x: auto;
    }

    .drawer-tab {
      padding: 10px 16px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Rajdhani', sans-serif;
      white-space: nowrap;
    }

    .drawer-tab.active {
      color: var(--admin-primary);
      border-bottom-color: var(--admin-primary);
    }

    .drawer-tab:hover:not(.active) {
      color: var(--text-primary);
    }

    .drawer-content {
      padding: 24px;
    }

    .drawer-section {
      margin-bottom: 24px;
    }

    .drawer-section-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* INFO GRID */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .info-item {
      background: var(--bg-tertiary);
      padding: 16px;
      border-radius: 8px;
    }

    .info-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .info-value {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .info-value.tech-id {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      color: var(--text-muted);
      background: var(--bg-tertiary);
      padding: 2px 6px;
      border-radius: 4px;
      border: 1px solid var(--border-primary);
    }

    /* TIMELINE */
    .timeline {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .timeline-item {
      display: flex;
      gap: 12px;
      padding: 16px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      border-left: 3px solid var(--admin-primary);
    }

    .timeline-icon {
      width: 32px;
      height: 32px;
      background: var(--admin-gradient);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .timeline-content {
      flex: 1;
    }

    .timeline-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .timeline-desc {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .timeline-time {
      font-size: 11px;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', monospace;
    }

    /* USAGE BARS */
    .usage-item {
      margin-bottom: 16px;
    }

    .usage-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .usage-label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* UI STATES */
    .ui-state {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 400px;
      padding: 32px;
    }

    .state-container {
      text-align: center;
      max-width: 400px;
    }

    .state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .state-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .state-desc {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 20px;
    }

    .state-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    /* FILTER PANEL */
    .filter-panel {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 500px;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border-primary);
      z-index: 150;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }

    .filter-panel.active {
      transform: translateX(0);
    }

    .filter-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--bg-tertiary);
    }

    .filter-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .filter-close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 20px;
      cursor: pointer;
      padding: 4px;
    }

    .filter-content {
      padding: 24px;
      overflow-y: auto;
      height: calc(100% - 80px);
    }

    .filter-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filter-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .filter-input,
    .filter-select {
      padding: 10px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: 'Rajdhani', sans-serif;
    }

    .filter-input:focus,
    .filter-select:focus {
      outline: none;
      border-color: var(--admin-primary);
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
    }

    .date-range {
      display: flex;
      gap: 8px;
    }

    .date-range input {
      flex: 1;
    }

    .filter-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      padding-top: 20px;
      border-top: 1px solid var(--border-primary);
    }

    /* MODAL */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 300;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: 14px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--bg-tertiary);
    }

    .modal-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 20px;
      cursor: pointer;
      padding: 4px;
    }

    .modal-content {
      padding: 24px;
    }

    .modal-footer {
      padding: 20px 24px;
      border-top: 1px solid var(--border-primary);
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      background: var(--bg-tertiary);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: 'Rajdhani', sans-serif;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--admin-primary);
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .form-help {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .form-error {
      font-size: 12px;
      color: var(--secondary-red);
      margin-top: 4px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
    }

    .radio-group {
      display: flex;
      gap: 16px;
      margin-top: 8px;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .radio-option input[type="radio"] {
      width: auto;
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid var(--border-primary);
      border-top-color: var(--admin-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .usage-value {
      font-size: 12px;
      color: var(--text-muted);
      font-family: 'JetBrains Mono', monospace;
    }

    .usage-bar {
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
    }

    .usage-fill {
      height: 100%;
      background: var(--admin-gradient);
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    .usage-fill.warning {
      background: linear-gradient(135deg, #FFD700 0%, #FF8C00 100%);
    }

    .usage-fill.danger {
      background: linear-gradient(135deg, #FF4444 0%, #CC0000 100%);
    }

    /* MODAL */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 300;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: 14px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .modal-close {
      width: 32px;
      height: 32px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      color: var(--text-muted);
    }

    .modal-close:hover {
      color: var(--text-primary);
      border-color: var(--admin-primary);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 24px;
      border-top: 1px solid var(--border-primary);
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    /* FORM */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      font-family: 'Rajdhani', sans-serif;
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--admin-primary);
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .checkbox-group label {
      font-size: 14px;
      color: var(--text-secondary);
      cursor: pointer;
    }

    /* PAGINATION */
    .pagination {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-primary);
    }

    .pagination-info {
      font-size: 14px;
      color: var(--text-muted);
    }

    .pagination-controls {
      display: flex;
      gap: 8px;
    }

    .page-btn {
      padding: 8px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .page-btn:hover {
      border-color: var(--admin-primary);
      color: var(--admin-primary);
    }

    .page-btn.active {
      background: var(--admin-gradient);
      color: white;
      border-color: transparent;
    }

    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 60px 24px;
      color: var(--text-muted);
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    .empty-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .empty-text {
      font-size: 14px;
    }

    /* RESPONSIVE */
    @media (max-width: 1200px) {
      .kpi-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }

      .sidebar.sidebar-open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .content-area {
        padding: 16px;
      }

      .header {
        padding: 16px;
      }

      .header-top {
        flex-direction: column;
        gap: 16px;
      }

      .kpi-grid {
        grid-template-columns: 1fr;
      }

      .drawer {
        width: 100%;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }

      .data-table {
        font-size: 12px;
      }

      .data-table th,
      .data-table td {
        padding: 12px 8px;
      }
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-primary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--admin-primary);
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <div class="logo-icon">‚ö°</div>
        <div class="logo-text">Admin Panel</div>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Principal</div>
          <a href="/admin" class="nav-item">
            <span class="nav-icon">üìä</span>
            <span>Dashboard</span>
          </a>
          <a href="/admin/users" class="nav-item">
            <span class="nav-icon">üë•</span>
            <span>Usuarios</span>
          </a>
          <a href="/admin/tipsters" class="nav-item">
            <span class="nav-icon">‚≠ê</span>
            <span>Tipsters</span>
          </a>
          <a href="/admin/signals" class="nav-item">
            <span class="nav-icon">üì°</span>
            <span>Se√±ales</span>
          </a>
          <a href="/admin/bets" class="nav-item">
            <span class="nav-icon">üé≤</span>
            <span>Apuestas</span>
          </a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Finanzas</div>
          <a href="/admin/finance" class="nav-item">
            <span class="nav-icon">üí∞</span>
            <span>Finanzas</span>
          </a>
          <a href="/admin/credits" class="nav-item">
            <span class="nav-icon">üí≥</span>
            <span>Cr√©ditos</span>
          </a>
          <a href="/admin/subscriptions" class="nav-item active">
            <span class="nav-icon">‚≠ê</span>
            <span>Suscripciones</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Operaciones</div>
          <a href="/admin/support" class="nav-item">
            <span class="nav-icon">üí¨</span>
            <span>Soporte</span>
          </a>
          <a href="/admin/alerts" class="nav-item">
            <span class="nav-icon">‚ö†Ô∏è</span>
            <span>Alertas</span>
          </a>
          <a href="/admin/compliance" class="nav-item">
            <span class="nav-icon">üîí</span>
            <span>Compliance</span>
          </a>
          <a href="/admin/audit" class="nav-item">
            <span class="nav-icon">üìã</span>
            <span>Auditor√≠a</span>
          </a>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Sistema</div>
          <a href="/admin/community" class="nav-item">
            <span class="nav-icon">üåê</span>
            <span>Comunidad</span>
          </a>
          <a href="/admin/referrals" class="nav-item">
            <span class="nav-icon">üéÅ</span>
            <span>Referidos</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header-top">
          <div>
            <h1 class="header-title">Gesti√≥n de Suscripciones</h1>
            <p class="header-subtitle">Administrar planes, suscripciones y activaciones de usuarios</p>
          </div>
          <div class="header-controls">
            <div class="date-range-controls">
              <input type="date" class="form-input date-input" id="dateFrom" placeholder="Desde">
              <input type="date" class="form-input date-input" id="dateTo" placeholder="Hasta">
            </div>
            <button class="btn btn-outline" id="refreshBtn">
              <span>üîÑ</span>
              Refresh
            </button>
            <button class="btn btn-outline" id="exportBtn">
              <span>üìä</span>
              Exportar
            </button>
          </div>
        </div>
        <div class="status-chips">
          <div class="chip healthy" id="financeSyncStatus">
            <span>üü¢</span>
            <span>Finance Sync</span>
            <span class="chip-badge">OK</span>
          </div>
          <div class="chip healthy" id="jobsStatus">
            <span>‚öôÔ∏è</span>
            <span>Jobs</span>
            <span class="chip-badge">Running</span>
          </div>
          <div class="chip warn" id="reconcileStatus">
            <span>‚ö†Ô∏è</span>
            <span>Reconcile</span>
            <span class="chip-badge">2 pendientes</span>
          </div>
        </div>
      </header>

      <!-- Top Controls -->
      <div class="top-controls">
        <div class="search-section">
          <input type="text" class="search-input" id="searchInput" placeholder="Buscar usuario, email, orderId...">
          <button class="btn btn-primary" id="searchBtn">Buscar</button>
        </div>
        <div class="quick-filters">
          <select class="form-select" id="statusFilter">
            <option value="">Todos los estados</option>
            <option value="active">Activo</option>
            <option value="pending">Pendiente</option>
            <option value="canceled">Cancelado</option>
            <option value="expired">Expirado</option>
          </select>
          <select class="form-select" id="paymentStatusFilter">
            <option value="">Todos los pagos</option>
            <option value="paid">Pagado</option>
            <option value="pending">Pendiente</option>
            <option value="failed">Fallido</option>
            <option value="refunded">Reembolsado</option>
          </select>
          <select class="form-select" id="sourceFilter">
            <option value="">Todas las fuentes</option>
            <option value="web">Web</option>
            <option value="mobile">M√≥vil</option>
            <option value="admin">Admin</option>
            <option value="api">API</option>
          </select>
          <select class="form-select" id="tipsterIdFilter">
            <option value="">Todos los tipsters</option>
            <option value="tipster1">Tipster Pro</option>
            <option value="tipster2">VIP Tips</option>
            <option value="tipster3">Premium Signals</option>
          </select>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        <div class="container">
          <!-- Tabs -->
          <div class="tabs">
            <button class="tab main-tab active" data-tab="overview">Overview</button>
            <button class="tab main-tab" data-tab="plans">Planes</button>
            <button class="tab main-tab" data-tab="subscriptions">Suscripciones</button>
            <button class="tab main-tab" data-tab="payments">Payments</button>
            <button class="tab main-tab" data-tab="adjustments">Ajustes</button>
            <button class="tab main-tab" data-tab="config">Config</button>
          </div>

          <!-- Overview Tab -->
          <div id="tab-overview" class="tab-content active">
            <!-- KPI Grid -->
            <div class="kpi-grid">
              <div class="kpi-card">
                <div class="kpi-header">
                  <div class="kpi-icon">üë•</div>
                  <div class="kpi-label">SUSCRIPCIONES ACTIVAS</div>
                </div>
                <div class="kpi-value">124</div>
                <div class="kpi-delta positive">
                  <span>‚Üó</span>
                  <span>+12% este mes</span>
                </div>
              </div>
              <div class="kpi-card">
                <div class="kpi-header">
                  <div class="kpi-icon">üí∞</div>
                  <div class="kpi-label">MRR</div>
                </div>
                <div class="kpi-value">$3,450</div>
                <div class="kpi-delta positive">
                  <span>‚Üó</span>
                  <span>+8% este mes</span>
                </div>
              </div>
              <div class="kpi-card">
                <div class="kpi-header">
                  <div class="kpi-icon">üìâ</div>
                  <div class="kpi-label">CHURN (30d)</div>
                </div>
                <div class="kpi-value">3.2%</div>
                <div class="kpi-delta negative">
                  <span>‚Üò</span>
                  <span>-0.5% vs mes pasado</span>
                </div>
              </div>
              <div class="kpi-card">
                <div class="kpi-header">
                  <div class="kpi-icon">üí≥</div>
                  <div class="kpi-label">FALLAS DE PAGO</div>
                </div>
                <div class="kpi-value">7</div>
                <div class="kpi-delta positive">
                  <span>‚Üò</span>
                  <span>-3 vs ayer</span>
                </div>
              </div>
            </div>

            <!-- Tipsters Usage Section -->
            <div class="table-container">
              <div class="table-header">
                <h3 class="table-title">Tipsters Usage</h3>
                <div class="table-actions">
                  <button class="btn btn-outline btn-sm" onclick="refreshTipstersUsage()">üîÑ Actualizar</button>
                </div>
              </div>
              <div class="table-wrapper" style="overflow-x: auto;">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Usuario</th>
                      <th>Plan</th>
                      <th>L√≠mite Follow</th>
                      <th>Followings Actuales</th>
                      <th>Uso %</th>
                      <th>Estado</th>
                      <th>Acci√≥n</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">AR</div>
                          <div class="user-info">
                            <div class="user-name">Ana R.</div>
                            <div class="user-email">ana@trading.com</div>
                          </div>
                        </div>
                      </td>
                      <td>Pro</td>
                      <td>5</td>
                      <td>3</td>
                      <td>60%</td>
                      <td><span class="badge active">‚úì OK</span></td>
                      <td>
                        <button class="action-btn" onclick="viewUserTipsters('user_123')">Ver</button>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">BS</div>
                          <div class="user-info">
                            <div class="user-name">Bruno S.</div>
                            <div class="user-email">bruno@trading.com</div>
                          </div>
                        </div>
                      </td>
                      <td>Tipster Gold</td>
                      <td>10</td>
                      <td>10</td>
                      <td>100%</td>
                      <td><span class="badge warning">‚ö†Ô∏è L√≠mite alcanzado</span></td>
                      <td>
                        <button class="action-btn primary" onclick="suggestUpgrade('user_456')">Sugerir Upgrade</button>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">CM</div>
                          <div class="user-info">
                            <div class="user-name">Carla M.</div>
                            <div class="user-email">carla@trading.com</div>
                          </div>
                        </div>
                      </td>
                      <td>Starter</td>
                      <td>2</td>
                      <td>1</td>
                      <td>50%</td>
                      <td><span class="badge active">‚úì OK</span></td>
                      <td>
                        <button class="action-btn" onclick="viewUserTipsters('user_789')">Ver</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="usage-info">
                <p><strong>Nota:</strong> Los l√≠mites se resetean a las <strong>00:00 UTC</strong> diariamente</p>
                <p>Los usuarios con l√≠mite alcanzado pueden recibir sugerencias de upgrade autom√°ticas</p>
              </div>
            </div>

            <!-- Recent Activity -->
            <div class="table-container">
              <div class="table-header">
                <h3 class="table-title">Actividad Reciente</h3>
                <button class="btn btn-sm btn-outline">Ver todo</button>
              </div>
              <div class="table-wrapper" style="overflow-x: auto;">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Usuario</th>
                      <th>Plan</th>
                      <th>Acci√≥n</th>
                      <th>Estado</th>
                      <th>Monto</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>2026-02-12 14:30</td>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">AR</div>
                          <div class="user-info">
                            <div class="user-name">Ana R.</div>
                            <div class="user-email">ana@trading.com</div>
                          </div>
                        </div>
                      </td>
                      <td>Pro</td>
                      <td>Activaci√≥n</td>
                      <td><span class="badge active">‚úì Confirmado</span></td>
                      <td>$19.00</td>
                    </tr>
                    <tr>
                      <td>2026-02-12 13:15</td>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">BS</div>
                          <div class="user-info">
                            <div class="user-name">Bruno S.</div>
                            <div class="user-email">bruno@trading.com</div>
                          </div>
                        </div>
                      </td>
                      <td>Tipster Gold</td>
                      <td>Upgrade</td>
                      <td><span class="badge pending">‚è≥ Pendiente</span></td>
                      <td>$29.00</td>
                    </tr>
                    <tr>
                      <td>2026-02-12 12:45</td>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">CM</div>
                          <div class="user-info">
                            <div class="user-name">Carla M.</div>
                            <div class="user-email">carla@trading.com</div>
                          </div>
                        </div>
                      </td>
                      <td>Starter</td>
                      <td>Expiraci√≥n</td>
                      <td><span class="badge expired">‚ö†Ô∏è Expirado</span></td>
                      <td>-</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Plans Tab -->
          <div id="tab-plans" class="tab-content" style="display: none;">
            <div class="table-container">
              <div class="table-header">
                <h3 class="table-title">Planes de Suscripci√≥n</h3>
                <button class="btn btn-primary">
                  <span>‚ûï</span>
                  Nuevo Plan
                </button>
              </div>
              <div class="table-wrapper" style="overflow-x: auto;">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Plan</th>
                      <th>Scope</th>
                      <th>Precio</th>
                      <th>Periodo</th>
                      <th>Estado</th>
                      <th>Features</th>
                      <th>L√≠mites</th>
                      <th>√ölt. actualizaci√≥n</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <div class="user-info">
                          <div class="user-name">Starter</div>
                        </div>
                      </td>
                      <td><span class="badge global">Global</span></td>
                      <td>$9</td>
                      <td>Mensual</td>
                      <td><span class="badge active">Activo</span></td>
                      <td>
                        <div class="feature-chips">
                          <span class="feature-chip">Se√±ales</span>
                        </div>
                      </td>
                      <td class="limits-text">50 req/d√≠a</td>
                      <td>2026-02-10</td>
                      <td>
                        <button class="action-btn">Editar</button>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="user-info">
                          <div class="user-name">Pro</div>
                        </div>
                      </td>
                      <td><span class="badge global">Global</span></td>
                      <td>$19</td>
                      <td>Mensual</td>
                      <td><span class="badge active">Activo</span></td>
                      <td>
                        <div class="feature-chips">
                          <span class="feature-chip">Se√±ales</span>
                          <span class="feature-chip">Surebets</span>
                        </div>
                      </td>
                      <td class="limits-text">200 req/d√≠a</td>
                      <td>2026-02-11</td>
                      <td>
                        <button class="action-btn">Editar</button>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="user-info">
                          <div class="user-name">Tipster Gold</div>
                        </div>
                      </td>
                      <td><span class="badge tipster">Tipster</span></td>
                      <td>$29</td>
                      <td>Mensual</td>
                      <td><span class="badge draft">Borrador</span></td>
                      <td>
                        <div class="feature-chips">
                          <span class="feature-chip">Tipsters</span>
                        </div>
                      </td>
                      <td class="limits-text">10 follow</td>
                      <td>2026-02-12</td>
                      <td>
                        <button class="action-btn primary">Publicar</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Subscriptions Tab -->
          <div id="tab-subscriptions" class="tab-content" style="display: none;">
            <div class="table-container">
              <div class="table-header">
                <h3 class="table-title">Suscripciones de Usuarios</h3>
                <div class="table-actions">
                  <button class="btn btn-outline btn-sm">Filtrar</button>
                  <button class="btn btn-primary btn-sm">
                    <span>‚ûï</span>
                    Nueva
                  </button>
                </div>
              </div>
              <div class="table-wrapper" style="overflow-x: auto;">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Usuario</th>
                      <th>Plan</th>
                      <th>Status</th>
                      <th>PaymentStatus</th>
                      <th>Auto-renew</th>
                      <th>Inicio</th>
                      <th>Fin</th>
                      <th>Source</th>
                      <th>Tipster</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">AR</div>
                          <div class="user-info">
                            <div class="user-name">Ana R.</div>
                            <div class="user-email">ana@trading.com</div>
                          </div>
                        </div>
                      </td>
                      <td>Pro</td>
                      <td><span class="badge active">Activo</span></td>
                      <td><span class="badge confirmed">Confirmado</span></td>
                      <td><span class="badge active">ON</span></td>
                      <td>2026-01-12</td>
                      <td>2026-02-12</td>
                      <td>Web</td>
                      <td>-</td>
                      <td>
                        <button class="action-btn">Ver</button>
                        <button class="action-btn">Extender</button>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">BS</div>
                          <div class="user-info">
                            <div class="user-name">Bruno S.</div>
                            <div class="user-email">bruno@trading.com</div>
                          </div>
                        </div>
                      </td>
                      <td>Tipster Gold</td>
                      <td><span class="badge pending">Pendiente</span></td>
                      <td><span class="badge pending">Pendiente</span></td>
                      <td><span class="badge canceled">OFF</span></td>
                      <td>2026-02-01</td>
                      <td>2026-03-01</td>
                      <td>App</td>
                      <td>#T-984</td>
                      <td>
                        <button class="action-btn primary">Activar</button>
                        <button class="action-btn danger">Cancelar</button>
                      </td>
                    </tr>
                    <tr>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">CM</div>
                          <div class="user-info">
                            <div class="user-name">Carla M.</div>
                            <div class="user-email">carla@trading.com</div>
                          </div>
                        </div>
                      </td>
                      <td>Starter</td>
                      <td><span class="badge expired">Expirado</span></td>
                      <td><span class="badge failed">Fallido</span></td>
                      <td><span class="badge canceled">OFF</span></td>
                      <td>2025-12-01</td>
                      <td>2026-01-01</td>
                      <td>Web</td>
                      <td>-</td>
                      <td>
                        <button class="action-btn">Ver</button>
                        <button class="action-btn">Reactivar</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="pagination">
                <div class="pagination-info">Mostrando 1-3 de 124 suscripciones</div>
                <div class="pagination-controls">
                  <button class="page-btn">Anterior</button>
                  <button class="page-btn active">1</button>
                  <button class="page-btn">2</button>
                  <button class="page-btn">3</button>
                  <button class="page-btn">Siguiente</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Payments Tab -->
          <div id="tab-payments" class="tab-content" style="display: none;">
            <div class="table-container">
              <div class="table-header">
                <h3 class="table-title">Pagos y Activaciones</h3>
                <button class="btn btn-outline btn-sm">Reconciliar</button>
              </div>
              <div class="table-wrapper" style="overflow-x: auto;">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>OrderId/InvoiceId</th>
                      <th>Usuario</th>
                      <th>Monto</th>
                      <th>Estado Finance</th>
                      <th>Estado Subscripci√≥n</th>
                      <th>Fecha</th>
                      <th>Acci√≥n</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="limits-text">ORD-2026-001</td>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">AR</div>
                          <div class="user-info">
                            <div class="user-name">Ana R.</div>
                          </div>
                        </div>
                      </td>
                      <td>$19.00</td>
                      <td><span class="badge confirmed">Completado</span></td>
                      <td><span class="badge active">Activo</span></td>
                      <td>2026-02-12 14:30</td>
                      <td>
                        <button class="action-btn">Ver</button>
                      </td>
                    </tr>
                    <tr>
                      <td class="limits-text">ORD-2026-002</td>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">BS</div>
                          <div class="user-info">
                            <div class="user-name">Bruno S.</div>
                          </div>
                        </div>
                      </td>
                      <td>$29.00</td>
                      <td><span class="badge confirmed">Completado</span></td>
                      <td><span class="badge pending">Pendiente</span></td>
                      <td>2026-02-12 13:15</td>
                      <td>
                        <button class="action-btn primary">Activar</button>
                      </td>
                    </tr>
                    <tr>
                      <td class="limits-text">ORD-2026-003</td>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">CM</div>
                          <div class="user-info">
                            <div class="user-name">Carla M.</div>
                          </div>
                        </div>
                      </td>
                      <td>$9.00</td>
                      <td><span class="badge failed">Fallido</span></td>
                      <td><span class="badge expired">Expirado</span></td>
                      <td>2026-02-12 12:45</td>
                      <td>
                        <button class="action-btn">Reintentar</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Adjustments Tab -->
          <div id="tab-adjustments" class="tab-content" style="display: none;">
            <div class="table-container">
              <div class="table-header">
                <h3 class="table-title">Upgrades & Ajustes</h3>
                <button class="btn btn-primary btn-sm">
                  <span>‚ûï</span>
                  Nuevo Ajuste
                </button>
              </div>
              <div class="table-wrapper" style="overflow-x: auto;">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Fecha</th>
                      <th>Usuario</th>
                      <th>Acci√≥n</th>
                      <th>Plan anterior ‚Üí nuevo</th>
                      <th>Motivo</th>
                      <th>Admin</th>
                      <th>Resultado</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>2026-02-12 13:15</td>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">BS</div>
                          <div class="user-info">
                            <div class="user-name">Bruno S.</div>
                          </div>
                        </div>
                      </td>
                      <td>Upgrade</td>
                      <td>Starter ‚Üí Tipster Gold</td>
                      <td>Cliente solicita acceso a tipsters</td>
                      <td>Admin_001</td>
                      <td><span class="badge pending">Pendiente</span></td>
                    </tr>
                    <tr>
                      <td>2026-02-12 11:30</td>
                      <td>
                        <div class="user-cell">
                          <div class="user-avatar">DM</div>
                          <div class="user-info">
                            <div class="user-name">Diego M.</div>
                          </div>
                        </div>
                      </td>
                      <td>Extensi√≥n</td>
                      <td>Pro ‚Üí Pro (ext. 30 d√≠as)</td>
                      <td>Compensaci√≥n por fallo t√©cnico</td>
                      <td>Admin_002</td>
                      <td><span class="badge active">‚úì Completado</span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Config Tab -->
          <div id="tab-config" class="tab-content" style="display: none;">
            <div class="table-container">
              <div class="table-header">
                <h3 class="table-title">Configuraci√≥n Global</h3>
                <button class="btn btn-primary">
                  <span>üíæ</span>
                  Guardar Cambios
                </button>
              </div>
              <div class="drawer-content">
                <div class="drawer-section">
                  <h4 class="drawer-section-title">Pol√≠ticas de Renovaci√≥n</h4>
                  <div class="info-grid">
                    <div class="info-item">
                      <div class="info-label">Auto-renew habilitado</div>
                      <div class="info-value">
                        <label class="checkbox-group">
                          <input type="checkbox" checked>
                          <span>S√≠</span>
                        </label>
                      </div>
                    </div>
                    <div class="info-item">
                      <div class="info-label">D√≠as antes de renovaci√≥n</div>
                      <div class="info-value">7 d√≠as</div>
                    </div>
                    <div class="info-item">
                      <div class="info-label">M√°ximo de reintentos</div>
                      <div class="info-value">3 intentos</div>
                    </div>
                    <div class="info-item">
                      <div class="info-label">Backoff entre intentos</div>
                      <div class="info-value">6 horas</div>
                    </div>
                  </div>
                </div>
                <div class="drawer-section">
                  <h4 class="drawer-section-title">L√≠mites por Defecto</h4>
                  <div class="info-grid">
                    <div class="info-item">
                      <div class="info-label">Requests por d√≠a</div>
                      <div class="info-value">100</div>
                    </div>
                    <div class="info-item">
                      <div class="info-label">Tipsters m√°ximos</div>
                      <div class="info-value">5</div>
                    </div>
                    <div class="info-item">
                      <div class="info-label">Reset de l√≠mites</div>
                      <div class="info-value">00:00 UTC</div>
                    </div>
                    <div class="info-item">
                      <div class="info-label">Prorrateo habilitado</div>
                      <div class="info-value">
                        <label class="checkbox-group">
                          <input type="checkbox">
                          <span>No</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- UI States -->
  <div id="ui-loading" class="ui-state" style="display: none;">
    <div class="state-container">
      <div class="state-icon">‚è≥</div>
      <h3 class="state-title">Cargando suscripciones...</h3>
      <p class="state-desc">Por favor espera mientras cargamos los datos</p>
    </div>
  </div>

  <div id="ui-empty" class="ui-state" style="display: none;">
    <div class="state-container">
      <div class="state-icon">üì≠</div>
      <h3 class="state-title">Sin resultados</h3>
      <p class="state-desc">No se encontraron suscripciones con los filtros actuales</p>
      <button class="btn btn-primary" onclick="clearFilters()">Limpiar filtros</button>
    </div>
  </div>

  <div id="ui-error" class="ui-state" style="display: none;">
    <div class="state-container">
      <div class="state-icon">‚ùå</div>
      <h3 class="state-title">Error al cargar datos</h3>
      <p class="state-desc" id="error-message">Error desconocido</p>
      <div class="state-actions">
        <button class="btn btn-primary" onclick="loadData()">Reintentar</button>
        <button class="btn btn-outline" onclick="copyErrorId()">Copiar errorId</button>
      </div>
    </div>
  </div>

  <!-- Filter Panel -->
  <div id="filterPanel" class="filter-panel" style="display: none;">
    <div class="filter-header">
      <h3 class="filter-title">Filtros</h3>
      <button class="filter-close" onclick="toggleFilters()">‚úï</button>
    </div>
    <div class="filter-content">
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label">Usuario ID</label>
          <input type="text" id="filter-userId" class="filter-input" placeholder="Ej: user_123">
        </div>
        <div class="filter-group">
          <label class="filter-label">Plan ID</label>
          <select id="filter-planId" class="filter-select">
            <option value="">Todos los planes</option>
            <option value="starter">Starter</option>
            <option value="pro">Pro</option>
            <option value="tipster-gold">Tipster Gold</option>
          </select>
        </div>
        <div class="filter-group">
          <label class="filter-label">Estado</label>
          <select id="filter-status" class="filter-select">
            <option value="">Todos</option>
            <option value="active">Activo</option>
            <option value="pending">Pendiente</option>
            <option value="expired">Expirado</option>
            <option value="canceled">Cancelado</option>
          </select>
        </div>
        <div class="filter-group">
          <label class="filter-label">Estado Pago</label>
          <select id="filter-paymentStatus" class="filter-select">
            <option value="">Todos</option>
            <option value="confirmed">Confirmado</option>
            <option value="pending">Pendiente</option>
            <option value="failed">Fallido</option>
          </select>
        </div>
      </div>
      <div class="filter-row">
        <div class="filter-group">
          <label class="filter-label">Auto-renovaci√≥n</label>
          <select id="filter-autoRenew" class="filter-select">
            <option value="">Todos</option>
            <option value="true">S√≠</option>
            <option value="false">No</option>
          </select>
        </div>
        <div class="filter-group">
          <label class="filter-label">Scope</label>
          <select id="filter-scope" class="filter-select">
            <option value="">Todos</option>
            <option value="global">Global</option>
            <option value="tipster">Tipster</option>
          </select>
        </div>
        <div class="filter-group">
          <label class="filter-label">Tipster ID</label>
          <input type="text" id="filter-tipsterId" class="filter-input" placeholder="Ej: tipster_123">
        </div>
        <div class="filter-group">
          <label class="filter-label">Rango Fechas</label>
          <div class="date-range">
            <input type="date" id="filter-from" class="filter-input">
            <input type="date" id="filter-to" class="filter-input">
          </div>
        </div>
      </div>
      <div class="filter-actions">
        <button class="btn btn-primary" onclick="applyFilters()">Aplicar filtros</button>
        <button class="btn btn-outline" onclick="clearFilters()">Limpiar todo</button>
      </div>
    </div>
  </div>

  <!-- Drawer -->
  <div class="drawer-overlay" id="drawerOverlay"></div>
  <div class="drawer" id="drawer">
    <div class="drawer-header">
      <h3 class="drawer-title">Detalle de Suscripci√≥n</h3>
      <button class="drawer-close" id="drawerClose">‚úï</button>
    </div>
    <div class="drawer-tabs">
      <button class="drawer-tab active" data-drawer-tab="overview">Overview</button>
      <button class="drawer-tab" data-drawer-tab="timeline">Timeline</button>
      <button class="drawer-tab" data-drawer-tab="payments">Payments</button>
      <button class="drawer-tab" data-drawer-tab="limits">Limits/Usage</button>
      <button class="drawer-tab" data-drawer-tab="audit">Audit</button>
    </div>
    <div class="drawer-content">
      <div id="drawer-overview" class="drawer-tab-content active">
        <div class="drawer-section">
          <h4 class="drawer-section-title">Informaci√≥n General</h4>
          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Usuario</div>
              <div class="info-value">Ana R. (ana@trading.com)</div>
            </div>
            <div class="info-item">
              <div class="info-label">ID Usuario</div>
              <div class="info-value tech-id">user_123</div>
            </div>
            <div class="info-item">
              <div class="info-label">Plan Actual</div>
              <div class="info-value">Pro</div>
            </div>
            <div class="info-item">
              <div class="info-label">ID Suscripci√≥n</div>
              <div class="info-value tech-id">sub_456</div>
            </div>
            <div class="info-item">
              <div class="info-label">Estado</div>
              <div class="info-value">
                <span class="badge active">Activo</span>
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">Payment Status</div>
              <div class="info-value">
                <span class="badge confirmed">Confirmado</span>
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">Fecha Inicio</div>
              <div class="info-value">2026-01-01</div>
            </div>
            <div class="info-label">Fecha Fin</div>
              <div class="info-value">2026-02-01</div>
            </div>
            <div class="info-item">
              <div class="info-label">Auto-renovaci√≥n</div>
              <div class="info-value">
                <label class="checkbox-group">
                  <input type="checkbox" checked>
                  <span>S√≠</span>
                </label>
              </div>
            </div>
            <div class="info-item">
              <div class="info-label">Tipster</div>
              <div class="info-value">#T-001 - Carlos Trading</div>
            </div>
            <div class="info-item">
              <div class="info-label">Order ID</div>
              <div class="info-value tech-id">ORD-2026-001</div>
            </div>
            <div class="info-item">
              <div class="info-label">Idempotency Key</div>
              <div class="info-value tech-id">ik_789abc123</div>
            </div>
          </div>
        </div>
        <div class="drawer-section">
          <h4 class="drawer-section-title">Navegaci√≥n R√°pida</h4>
          <div class="action-buttons">
            <button class="btn btn-outline" onclick="navigateToUser('user_123')">üë§ Ver Perfil Usuario</button>
            <button class="btn btn-outline" onclick="navigateToFinance('ORD-2026-001')">üí∞ Ver en Finance</button>
            <button class="btn btn-outline" onclick="navigateToCredits('user_123')">‚ö° Ver Cr√©ditos</button>
            <button class="btn btn-outline" onclick="navigateToTipsters('user_123')">üìä Ver Tipsters</button>
          </div>
        </div>
        <div class="drawer-section">
          <h4 class="drawer-section-title">Acciones R√°pidas</h4>
          <div class="action-buttons">
            <button class="btn btn-primary" onclick="showModal('activate')">Activar</button>
            <button class="btn btn-danger" onclick="showModal('cancel')">Cancelar</button>
            <button class="btn btn-outline" onclick="showModal('extend')">Extender</button>
            <button class="btn btn-outline" onclick="showModal('upgrade')">Cambiar Plan</button>
            <button class="btn btn-outline" onclick="showModal('feature')">Ajustar L√≠mite</button>
          </div>
        </div>
      </div>
      <div id="drawer-timeline" class="drawer-tab-content">
        <div class="timeline">
          <div class="timeline-item">
            <div class="timeline-date">2026-01-01 10:30</div>
            <div class="timeline-title">Suscripci√≥n creada</div>
            <div class="timeline-desc">Plan Pro activado por usuario</div>
          </div>
          <div class="timeline-item">
            <div class="timeline-date">2026-01-15 14:20</div>
            <div class="timeline-title">Pago confirmado</div>
            <div class="timeline-desc">Pago de $19.00 procesado exitosamente</div>
          </div>
          <div class="timeline-item">
            <div class="timeline-date">2026-01-20 09:15</div>
            <div class="timeline-title">L√≠mite ajustado</div>
            <div class="timeline-desc">Requests diarios aumentados a 1500 por admin</div>
          </div>
        </div>
      </div>
      <div id="drawer-payments" class="drawer-tab-content">
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Monto</th>
                <th>Estado</th>
                <th>Fecha</th>
                <th>M√©todo</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>ORD-2026-001</td>
                <td>$19.00</td>
                <td><span class="badge confirmed">Completado</span></td>
                <td>2026-01-01 10:30</td>
                <td>Tarjeta de cr√©dito</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div id="drawer-limits" class="drawer-tab-content">
        <div class="limits-grid">
          <div class="limit-item">
            <div class="limit-label">Requests por d√≠a</div>
            <div class="limit-value">1000 / 1500</div>
            <div class="limit-bar">
              <div class="limit-bar-fill" style="width: 66%"></div>
            </div>
          </div>
          <div class="limit-item">
            <div class="limit-label">Tipsters activos</div>
            <div class="limit-value">3 / 5</div>
            <div class="limit-bar">
              <div class="limit-bar-fill" style="width: 60%"></div>
            </div>
          </div>
          <div class="limit-item">
            <div class="limit-label">Follow.limit</div>
            <div class="limit-value">15 / 20</div>
            <div class="limit-bar">
              <div class="limit-bar-fill" style="width: 75%"></div>
            </div>
          </div>
          <div class="limit-item">
            <div class="limit-label">Followings actuales</div>
            <div class="limit-value">12 usuarios</div>
            <div class="limit-bar">
              <div class="limit-bar-fill" style="width: 60%"></div>
            </div>
          </div>
        </div>
      </div>
      <div id="drawer-audit" class="drawer-tab-content">
        <div class="audit-log">
          <div class="audit-entry">
            <div class="audit-date">2026-01-20 09:15</div>
            <div class="audit-user">admin@trading.com</div>
            <div class="audit-action">L√≠mite ajustado: requests diarios 1000 ‚Üí 1500</div>
            <div class="audit-reason">Motivo: Cliente VIP</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div class="modal-overlay" id="modalOverlay"></div>
  
  <!-- Activate Modal -->
  <div class="modal" id="activateModal">
    <div class="modal-header">
      <h3 class="modal-title">Activar Suscripci√≥n</h3>
      <button class="modal-close" onclick="hideModal('activate')">‚úï</button>
    </div>
    <div class="modal-body">
      <form id="activateForm">
        <div class="form-group">
          <label class="form-label">Order ID / Invoice ID</label>
          <input type="text" id="activateOrderId" class="form-input" readonly>
        </div>
        <div class="form-group">
          <label class="checkbox-group">
            <input type="checkbox" id="activateConfirm" required>
            <span>Confirmo que el pago ha sido verificado</span>
          </label>
        </div>
        <div class="form-group">
          <label class="form-label">Motivo</label>
          <textarea id="activateReason" class="form-textarea" placeholder="Describa el motivo de la activaci√≥n" required></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="hideModal('activate')">Cancelar</button>
      <button class="btn btn-primary" id="activateSubmit" onclick="submitActivate()">Activar</button>
    </div>
  </div>

  <!-- Cancel Modal -->
  <div class="modal" id="cancelModal">
    <div class="modal-header">
      <h3 class="modal-title">Cancelar Suscripci√≥n</h3>
      <button class="modal-close" onclick="hideModal('cancel')">‚úï</button>
    </div>
    <div class="modal-body">
      <form id="cancelForm">
        <div class="form-group">
          <label class="form-label">Tipo de Cancelaci√≥n</label>
          <select id="cancelType" class="form-select" required>
            <option value="">Seleccione...</option>
            <option value="immediate">Inmediata</option>
            <option value="end_cycle">Al final del ciclo</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Motivo</label>
          <textarea id="cancelReason" class="form-textarea" placeholder="Describa el motivo de la cancelaci√≥n" required></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="hideModal('cancel')">Cancelar</button>
      <button class="btn btn-danger" id="cancelSubmit" onclick="submitCancel()">Confirmar Cancelaci√≥n</button>
    </div>
  </div>

  <!-- Extend Modal -->
  <div class="modal" id="extendModal">
    <div class="modal-header">
      <h3 class="modal-title">Extender Suscripci√≥n</h3>
      <button class="modal-close" onclick="hideModal('extend')">‚úï</button>
    </div>
    <div class="modal-body">
      <form id="extendForm">
        <div class="form-group">
          <label class="form-label">M√©todo de Extensi√≥n</label>
          <select id="extendMethod" class="form-select" required>
            <option value="">Seleccione...</option>
            <option value="days">D√≠as adicionales</option>
            <option value="date">Fecha espec√≠fica</option>
          </select>
        </div>
        <div class="form-group" id="extendDaysGroup" style="display: none;">
          <label class="form-label">D√≠as adicionales</label>
          <input type="number" id="extendDays" class="form-input" min="1" max="365">
        </div>
        <div class="form-group" id="extendDateGroup" style="display: none;">
          <label class="form-label">Nueva fecha de fin</label>
          <input type="date" id="extendDate" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">Motivo</label>
          <textarea id="extendReason" class="form-textarea" placeholder="Describa el motivo de la extensi√≥n" required></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="hideModal('extend')">Cancelar</button>
      <button class="btn btn-primary" id="extendSubmit" onclick="submitExtend()">Extender</button>
    </div>
  </div>

  <!-- Upgrade/Downgrade Modal -->
  <div class="modal" id="upgradeModal">
    <div class="modal-header">
      <h3 class="modal-title">Cambiar Plan</h3>
      <button class="modal-close" onclick="hideModal('upgrade')">‚úï</button>
    </div>
    <div class="modal-body">
      <form id="upgradeForm">
        <div class="form-group">
          <label class="form-label">Plan Actual</label>
          <input type="text" id="currentPlan" class="form-input" readonly>
        </div>
        <div class="form-group">
          <label class="form-label">Nuevo Plan</label>
          <select id="newPlan" class="form-select" required>
            <option value="">Seleccione...</option>
            <option value="starter">Starter</option>
            <option value="pro">Pro</option>
            <option value="tipster-gold">Tipster Gold</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Fecha efectiva</label>
          <select id="effectiveDate" class="form-select" required>
            <option value="">Seleccione...</option>
            <option value="immediate">Inmediata</option>
            <option value="next_cycle">Pr√≥ximo ciclo</option>
            <option value="specific">Fecha espec√≠fica</option>
          </select>
        </div>
        <div class="form-group" id="specificDateGroup" style="display: none;">
          <label class="form-label">Fecha espec√≠fica</label>
          <input type="date" id="specificDate" class="form-input">
        </div>
        <div class="form-group">
          <label class="form-label">Motivo</label>
          <textarea id="upgradeReason" class="form-textarea" placeholder="Describa el motivo del cambio" required></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="hideModal('upgrade')">Cancelar</button>
      <button class="btn btn-primary" id="upgradeSubmit" onclick="submitUpgrade()">Cambiar Plan</button>
    </div>
  </div>

  <!-- Feature Adjust Modal -->
  <div class="modal" id="featureModal">
    <div class="modal-header">
      <h3 class="modal-title">Ajustar L√≠mite de Feature</h3>
      <button class="modal-close" onclick="hideModal('feature')">‚úï</button>
    </div>
    <div class="modal-body">
      <form id="featureForm">
        <div class="form-group">
          <label class="form-label">Feature</label>
          <select id="featureKey" class="form-select" required>
            <option value="">Seleccione...</option>
            <option value="requests_per_day">Requests por d√≠a</option>
            <option value="tipsters_max">Tipsters m√°ximos</option>
            <option value="storage_gb">Almacenamiento (GB)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">L√≠mite actual</label>
          <input type="text" id="currentLimit" class="form-input" readonly>
        </div>
        <div class="form-group">
          <label class="form-label">Nuevo l√≠mite</label>
          <input type="number" id="newLimit" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label">Motivo</label>
          <textarea id="featureReason" class="form-textarea" placeholder="Describa el motivo del ajuste" required></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="hideModal('feature')">Cancelar</button>
      <button class="btn btn-primary" id="featureSubmit" onclick="submitFeature()">Ajustar L√≠mite</button>
    </div>
  </div>

  <!-- Reconcile Modal -->
  <div class="modal" id="reconcileModal">
    <div class="modal-header">
      <h3 class="modal-title">Reconciliar Pago</h3>
      <button class="modal-close" onclick="hideModal('reconcile')">‚úï</button>
    </div>
    <div class="modal-body">
      <form id="reconcileForm">
        <div class="form-group">
          <label class="form-label">Order ID / Invoice ID</label>
          <input type="text" id="reconcileOrderId" class="form-input" required>
        </div>
        <div class="form-group">
          <label class="form-label">Vista previa de diferencias</label>
          <div class="reconcile-preview">
            <div class="reconcile-item">
              <span>Estado actual:</span>
              <span id="currentStatus">Pendiente</span>
            </div>
            <div class="reconcile-item">
              <span>Estado esperado:</span>
              <span id="expectedStatus">Completado</span>
            </div>
            <div class="reconcile-item">
              <span>Diferencia:</span>
              <span id="difference">$0.00</span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="checkbox-group">
            <input type="checkbox" id="reconcileConfirm" required>
            <span>Confirmo que la reconciliaci√≥n es correcta</span>
          </label>
        </div>
        <div class="form-group">
          <label class="form-label">Motivo</label>
          <textarea id="reconcileReason" class="form-textarea" placeholder="Describa el motivo de la reconciliaci√≥n" required></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="hideModal('reconcile')">Cancelar</button>
      <button class="btn btn-primary" id="reconcileSubmit" onclick="submitReconcile()">Confirmar Reconciliaci√≥n</button>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // Router implementation
    class SubscriptionsRouter {
      constructor() {
        this.currentTab = 'overview';
        this.filters = {
          userId: '',
          planId: '',
          status: '',
          paymentStatus: '',
          autoRenew: '',
          scope: '',
          tipsterId: '',
          dateFrom: '',
          dateTo: '',
          search: '',
          source: '',
          page: 1,
          limit: 10,
          sort: 'createdAt',
          order: 'desc'
        };
        this.init();
      }

      init() {
        this.loadStateFromURL();
        this.bindEvents();
        this.updateUI();
        this.setupDrawerDeepLink();
      }

      loadStateFromURL() {
        const params = new URLSearchParams(window.location.search);
        
        // Load tab
        const tab = params.get('tab');
        if (tab && ['overview', 'plans', 'subscriptions', 'payments', 'adjustments', 'config'].includes(tab)) {
          this.currentTab = tab;
        }

        // Load filters
        Object.keys(this.filters).forEach(key => {
          const value = params.get(key);
          if (value !== null) {
            this.filters[key] = value;
          }
        });

        // Load filter panel state
        const filterPanel = params.get('filterPanel');
        if (filterPanel === 'open') {
          document.getElementById('filterPanel').style.display = 'block';
        }

        // Handle drawer deep link
        const subscriptionId = params.get('subscriptionId');
        const userId = params.get('userId');
        const drawer = params.get('drawer');
        
        if ((subscriptionId || userId) && drawer === '1') {
          setTimeout(() => {
            if (subscriptionId) {
              this.openDrawerBySubscriptionId(subscriptionId);
            } else if (userId) {
              this.openDrawerByUserId(userId);
            }
          }, 500);
        }
      }

      updateURL() {
        const params = new URLSearchParams();
        
        // Add tab
        params.set('tab', this.currentTab);

        // Add filters (only non-empty values)
        Object.keys(this.filters).forEach(key => {
          if (this.filters[key] !== '' && this.filters[key] !== null && this.filters[key] !== undefined) {
            params.set(key, this.filters[key]);
          }
        });

        // Add filter panel state
        const filterPanel = document.getElementById('filterPanel');
        if (filterPanel.style.display === 'block') {
          params.set('filterPanel', 'open');
        }

        const newURL = `${window.location.pathname}?${params.toString()}`;
        window.history.replaceState({}, '', newURL);
      }

      switchTab(tabName) {
        if (this.currentTab === tabName) return;
        
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
          tab.style.display = 'none';
        });
        
        // Remove active class from all tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        
        // Show selected tab
        document.getElementById(`tab-${tabName}`).style.display = 'block';
        
        // Add active class to selected tab button
        const tabButton = document.querySelector(`[data-tab="${tabName}"]`);
        if (tabButton) {
          tabButton.classList.add('active');
        }
        
        // Show/hide date range controls based on tab
        const dateControls = document.querySelector('.date-controls');
        if (dateControls) {
          const tabsWithDateRange = ['overview', 'payments', 'adjustments'];
          dateControls.style.display = tabsWithDateRange.includes(tabName) ? 'flex' : 'none';
        }
        
        this.currentTab = tabName;
        this.updateURL();
        this.loadData();
      }

      updateFilter(key, value) {
        this.filters[key] = value;
        this.filters.page = 1; // Reset to first page when filters change
        this.updateURL();
        this.loadData();
      }

      clearFilters() {
        Object.keys(this.filters).forEach(key => {
          this.filters[key] = '';
        });
        this.filters.page = 1;
        this.updateURL();
        this.loadData();
        
        // Clear filter inputs
        document.querySelectorAll('.filter-input, .filter-select').forEach(input => {
          input.value = '';
        });
      }

      updateUI() {
        // Update active tab
        this.switchTab(this.currentTab);
        
        // Update filter inputs
        Object.keys(this.filters).forEach(key => {
          const input = document.getElementById(`filter-${key}`);
          if (input && this.filters[key]) {
            input.value = this.filters[key];
          }
        });
      }

      loadData() {
        // Show loading state
        this.showUIState('loading');
        
        // Simulate API call
        setTimeout(() => {
          // For demo purposes, show data
          this.showUIState('data');
          
          // Update pagination info
          this.updatePagination();
        }, 1000);
      }

      showUIState(state) {
        // Hide all UI states
        document.querySelectorAll('.ui-state').forEach(el => {
          el.style.display = 'none';
        });
        
        // Hide main content
        document.querySelector('.main-content').style.display = 'none';
        
        if (state === 'loading') {
          document.getElementById('ui-loading').style.display = 'flex';
        } else if (state === 'empty') {
          document.getElementById('ui-empty').style.display = 'flex';
        } else if (state === 'error') {
          document.getElementById('ui-error').style.display = 'flex';
        } else if (state === 'data') {
          // Show main content
          document.querySelector('.main-content').style.display = 'block';
        }
      }

      updatePagination() {
        const start = (this.filters.page - 1) * this.filters.limit + 1;
        const end = Math.min(this.filters.page * this.filters.limit, 124); // Total items: 124
        
        document.querySelector('.pagination-info').textContent = 
          `Mostrando ${start}-${end} de 124 suscripciones`;
      }

      bindEvents() {
        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const tab = e.target.dataset.tab;
            this.switchTab(tab);
          });
        });

        // Filter events
        document.querySelectorAll('.filter-input, .filter-select').forEach(input => {
          input.addEventListener('change', (e) => {
            const key = e.target.id.replace('filter-', '');
            this.updateFilter(key, e.target.value);
          });
        });

        // Top controls events
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        if (searchInput && searchBtn) {
          searchBtn.addEventListener('click', () => {
            this.updateFilter('search', searchInput.value);
          });
          searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
              this.updateFilter('search', searchInput.value);
            }
          });
        }

        // Quick filters
        const statusFilter = document.getElementById('statusFilter');
        const paymentStatusFilter = document.getElementById('paymentStatusFilter');
        const sourceFilter = document.getElementById('sourceFilter');
        const tipsterIdFilter = document.getElementById('tipsterIdFilter');
        const dateFrom = document.getElementById('dateFrom');
        const dateTo = document.getElementById('dateTo');

        if (statusFilter) {
          statusFilter.addEventListener('change', (e) => {
            this.updateFilter('status', e.target.value);
          });
        }
        if (paymentStatusFilter) {
          paymentStatusFilter.addEventListener('change', (e) => {
            this.updateFilter('paymentStatus', e.target.value);
          });
        }
        if (sourceFilter) {
          sourceFilter.addEventListener('change', (e) => {
            this.updateFilter('source', e.target.value);
          });
        }
        if (tipsterIdFilter) {
          tipsterIdFilter.addEventListener('change', (e) => {
            this.updateFilter('tipsterId', e.target.value);
          });
        }
        if (dateFrom) {
          dateFrom.addEventListener('change', (e) => {
            this.updateFilter('dateFrom', e.target.value);
          });
        }
        if (dateTo) {
          dateTo.addEventListener('change', (e) => {
            this.updateFilter('dateTo', e.target.value);
          });
        }

        // Refresh and export buttons
        const refreshBtn = document.getElementById('refreshBtn');
        const exportBtn = document.getElementById('exportBtn');
        if (refreshBtn) {
          refreshBtn.addEventListener('click', () => {
            this.loadData();
            showToast('Datos actualizados');
          });
        }
        if (exportBtn) {
          exportBtn.addEventListener('click', () => {
            this.exportData();
          });
        }

        // Pagination events
        document.querySelectorAll('.page-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const text = e.target.textContent;
            if (text === 'Anterior' && this.filters.page > 1) {
              this.filters.page--;
            } else if (text === 'Siguiente' && this.filters.page < 13) {
              this.filters.page++;
            } else if (!isNaN(text)) {
              this.filters.page = parseInt(text);
            }
            this.updateURL();
            this.loadData();
          });
        });
      }

      setupDrawerDeepLink() {
        // Escape key to close drawer
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            const drawer = document.getElementById('drawer');
            if (drawer && drawer.classList.contains('open')) {
              this.closeDrawer();
            }
          }
        });
      }

      openDrawerBySubscriptionId(subscriptionId) {
        console.log('Opening drawer for subscription:', subscriptionId);
        openDrawer(subscriptionId);
        
        // Update URL with drawer state
        const params = new URLSearchParams(window.location.search);
        params.set('subscriptionId', subscriptionId);
        params.set('drawer', '1');
        window.history.replaceState({}, '', `${window.location.pathname}?${params.toString()}`);
      }

      openDrawerByUserId(userId) {
        console.log('Opening drawer for user:', userId);
        openDrawer(userId);
        
        // Update URL with drawer state
        const params = new URLSearchParams(window.location.search);
        params.set('userId', userId);
        params.set('drawer', '1');
        window.history.replaceState({}, '', `${window.location.pathname}?${params.toString()}`);
      }

      closeDrawer() {
        closeDrawer();
        
        // Remove drawer parameters from URL
        const params = new URLSearchParams(window.location.search);
        params.delete('subscriptionId');
        params.delete('userId');
        params.delete('drawer');
        window.history.replaceState({}, '', `${window.location.pathname}?${params.toString()}`);
      }

      exportData() {
        // Simulate export
        showToast('Exportando datos...');
        setTimeout(() => {
          showToast('Exportaci√≥n completada');
        }, 2000);
      }
    }

    // Modal functions
    function showModal(modalType) {
      const modal = document.getElementById(`${modalType}Modal`);
      const overlay = document.getElementById('modalOverlay');
      
      if (modal) {
        modal.style.display = 'block';
        overlay.style.display = 'block';
        
        // Generate idempotency key
        const idempotencyKey = generateIdempotencyKey();
        modal.setAttribute('data-idempotency-key', idempotencyKey);
        
        // Setup specific modal logic
        setupModal(modalType);
      }
    }

    function hideModal(modalType) {
      const modal = document.getElementById(`${modalType}Modal`);
      const overlay = document.getElementById('modalOverlay');
      
      if (modal) {
        modal.style.display = 'none';
        overlay.style.display = 'none';
        
        // Reset form
        const form = modal.querySelector('form');
        if (form) {
          form.reset();
        }
        
        // Re-enable submit button
        const submitBtn = modal.querySelector('[id$="Submit"]');
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.innerHTML = submitBtn.getAttribute('data-original-text') || submitBtn.textContent;
        }
      }
    }

    function setupModal(modalType) {
      const modal = document.getElementById(`${modalType}Modal`);
      
      switch (modalType) {
        case 'extend':
          // Setup extend method change
          const extendMethod = document.getElementById('extendMethod');
          if (extendMethod) {
            extendMethod.addEventListener('change', (e) => {
              const daysGroup = document.getElementById('extendDaysGroup');
              const dateGroup = document.getElementById('extendDateGroup');
              
              if (e.target.value === 'days') {
                daysGroup.style.display = 'block';
                dateGroup.style.display = 'none';
              } else if (e.target.value === 'date') {
                daysGroup.style.display = 'none';
                dateGroup.style.display = 'block';
              }
            });
          }
          break;
          
        case 'upgrade':
          // Setup effective date change
          const effectiveDate = document.getElementById('effectiveDate');
          if (effectiveDate) {
            effectiveDate.addEventListener('change', (e) => {
              const specificDateGroup = document.getElementById('specificDateGroup');
              if (e.target.value === 'specific') {
                specificDateGroup.style.display = 'block';
              } else {
                specificDateGroup.style.display = 'none';
              }
            });
          }
          break;
      }
    }

    function generateIdempotencyKey() {
      return 'idemp_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function disableSubmitButton(buttonId) {
      const button = document.getElementById(buttonId);
      if (button) {
        button.disabled = true;
        button.setAttribute('data-original-text', button.innerHTML);
        button.innerHTML = '<span class="spinner"></span> Procesando...';
      }
    }

    function enableSubmitButton(buttonId) {
      const button = document.getElementById(buttonId);
      if (button) {
        button.disabled = false;
        button.innerHTML = button.getAttribute('data-original-text') || button.textContent;
      }
    }

    // Form submission functions
    function submitActivate() {
      const form = document.getElementById('activateForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      
      disableSubmitButton('activateSubmit');
      
      // Get idempotency key
      const modal = document.getElementById('activateModal');
      const idempotencyKey = modal.getAttribute('data-idempotency-key');
      
      // Simulate API call
      setTimeout(() => {
        console.log('Activating subscription with idempotency key:', idempotencyKey);
        hideModal('activate');
        enableSubmitButton('activateSubmit');
        
        // Show success message
        showToast('Suscripci√≥n activada exitosamente');
      }, 2000);
    }

    function submitCancel() {
      const form = document.getElementById('cancelForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      
      disableSubmitButton('cancelSubmit');
      
      // Get idempotency key
      const modal = document.getElementById('cancelModal');
      const idempotencyKey = modal.getAttribute('data-idempotency-key');
      
      // Simulate API call
      setTimeout(() => {
        console.log('Canceling subscription with idempotency key:', idempotencyKey);
        hideModal('cancel');
        enableSubmitButton('cancelSubmit');
        
        // Show success message
        showToast('Suscripci√≥n cancelada exitosamente');
      }, 2000);
    }

    function submitExtend() {
      const form = document.getElementById('extendForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      
      disableSubmitButton('extendSubmit');
      
      // Get idempotency key
      const modal = document.getElementById('extendModal');
      const idempotencyKey = modal.getAttribute('data-idempotency-key');
      
      // Simulate API call
      setTimeout(() => {
        console.log('Extending subscription with idempotency key:', idempotencyKey);
        hideModal('extend');
        enableSubmitButton('extendSubmit');
        
        // Show success message
        showToast('Suscripci√≥n extendida exitosamente');
      }, 2000);
    }

    function submitUpgrade() {
      const form = document.getElementById('upgradeForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      
      disableSubmitButton('upgradeSubmit');
      
      // Get idempotency key
      const modal = document.getElementById('upgradeModal');
      const idempotencyKey = modal.getAttribute('data-idempotency-key');
      
      // Simulate API call
      setTimeout(() => {
        console.log('Upgrading subscription with idempotency key:', idempotencyKey);
        hideModal('upgrade');
        enableSubmitButton('upgradeSubmit');
        
        // Show success message
        showToast('Plan cambiado exitosamente');
      }, 2000);
    }

    function submitFeature() {
      const form = document.getElementById('featureForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      
      disableSubmitButton('featureSubmit');
      
      // Get idempotency key
      const modal = document.getElementById('featureModal');
      const idempotencyKey = modal.getAttribute('data-idempotency-key');
      
      // Simulate API call
      setTimeout(() => {
        console.log('Adjusting feature with idempotency key:', idempotencyKey);
        hideModal('feature');
        enableSubmitButton('featureSubmit');
        
        // Show success message
        showToast('L√≠mite ajustado exitosamente');
      }, 2000);
    }

    function submitReconcile() {
      const form = document.getElementById('reconcileForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      
      disableSubmitButton('reconcileSubmit');
      
      // Get idempotency key
      const modal = document.getElementById('reconcileModal');
      const idempotencyKey = modal.getAttribute('data-idempotency-key');
      
      // Simulate API call
      setTimeout(() => {
        console.log('Reconciling payment with idempotency key:', idempotencyKey);
        hideModal('reconcile');
        enableSubmitButton('reconcileSubmit');
        
        // Show success message
        showToast('Reconciliaci√≥n completada exitosamente');
      }, 2000);
    }

    // Utility functions
    function toggleFilters() {
      const filterPanel = document.getElementById('filterPanel');
      const isVisible = filterPanel.style.display === 'block';
      
      filterPanel.style.display = isVisible ? 'none' : 'block';
      
      // Update URL
      if (window.router) {
        window.router.updateURL();
      }
    }

    function applyFilters() {
      // Collect all filter values
      const filters = {};
      document.querySelectorAll('.filter-input, .filter-select').forEach(input => {
        const key = input.id.replace('filter-', '');
        filters[key] = input.value;
      });
      
      // Update router filters
      if (window.router) {
        Object.keys(filters).forEach(key => {
          window.router.updateFilter(key, filters[key]);
        });
      }
      
      // Hide filter panel
      document.getElementById('filterPanel').style.display = 'none';
    }

    function clearFilters() {
      if (window.router) {
        window.router.clearFilters();
      }
    }

    function copyErrorId() {
      const errorId = 'err_' + Date.now();
      navigator.clipboard.writeText(errorId).then(() => {
        showToast('ID de error copiado al portapapeles');
      });
    }

    function showToast(message) {
      // Simple toast implementation
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('show');
      }, 100);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // Drawer functions
    function openDrawer(subscriptionId) {
      const drawer = document.getElementById('drawer');
      const overlay = document.getElementById('drawerOverlay');
      
      drawer.classList.add('open');
      overlay.style.display = 'block';
      
      // Load subscription data
      console.log('Loading subscription:', subscriptionId);
      
      // Update URL with subscriptionId and drawer parameter
      const url = new URL(window.location);
      url.searchParams.set('subscriptionId', subscriptionId);
      url.searchParams.set('drawer', '1');
      window.history.pushState({}, '', url);
    }

    function openDrawerByUserId(userId) {
      const drawer = document.getElementById('drawer');
      const overlay = document.getElementById('drawerOverlay');
      
      drawer.classList.add('open');
      overlay.style.display = 'block';
      
      // Load user data
      console.log('Loading user:', userId);
      
      // Update URL with userId and drawer parameter
      const url = new URL(window.location);
      url.searchParams.set('userId', userId);
      url.searchParams.set('drawer', '1');
      window.history.pushState({}, '', url);
    }

    function closeDrawer() {
      const drawer = document.getElementById('drawer');
      const overlay = document.getElementById('drawerOverlay');
      
      drawer.classList.remove('open');
      overlay.style.display = 'none';
      
      // Remove drawer parameters from URL
      const url = new URL(window.location);
      url.searchParams.delete('subscriptionId');
      url.searchParams.delete('userId');
      url.searchParams.delete('drawer');
      window.history.pushState({}, '', url);
    }

    // Initialize router
    document.addEventListener('DOMContentLoaded', () => {
      window.router = new SubscriptionsRouter();
      
      // Handle drawer opening on page load based on URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const subscriptionId = urlParams.get('subscriptionId');
      const userId = urlParams.get('userId');
      const drawerOpen = urlParams.get('drawer');
      
      if (drawerOpen === '1') {
        if (subscriptionId) {
          openDrawer(subscriptionId);
        } else if (userId) {
          openDrawerByUserId(userId);
        }
      }
      
      // Bind drawer events
      document.getElementById('drawerClose').addEventListener('click', closeDrawer);
      document.getElementById('drawerOverlay').addEventListener('click', closeDrawer);
      
      // Bind Escape key to close drawer
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeDrawer();
        }
      });
      
      // Bind modal overlay
      document.getElementById('modalOverlay').addEventListener('click', () => {
        // Close all modals
        document.querySelectorAll('.modal').forEach(modal => {
          modal.style.display = 'none';
        });
        document.getElementById('modalOverlay').style.display = 'none';
      });
      
      // Bind drawer tabs
      document.querySelectorAll('.drawer-tab').forEach(tab => {
        tab.addEventListener('click', (e) => {
          const tabName = e.target.dataset.drawerTab;
          
          // Remove active class from all tabs
          document.querySelectorAll('.drawer-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.drawer-tab-content').forEach(c => c.classList.remove('active'));
          
          // Add active class to selected tab
          e.target.classList.add('active');
          document.getElementById(`drawer-${tabName}`).classList.add('active');
        });
      });
    });

    // Tipsters Usage functions
    function refreshTipstersUsage() {
      // Simulate API call to refresh tipsters usage data
      showToast('Actualizando uso de tipsters...');
      
      setTimeout(() => {
        showToast('Datos de uso de tipsters actualizados');
      }, 1500);
    }

    function suggestUpgrade(userId) {
      // Show upgrade suggestion modal or send notification
      showToast('Sugerencia de upgrade enviada al usuario');
      
      // Simulate sending upgrade suggestion
      console.log('Sending upgrade suggestion to user:', userId);
      
      // You could also open a modal here for more detailed upgrade options
      // openModal('upgradeSuggestion');
    }

    function viewUserTipsters(userId) {
      // Navigate to user's tipsters page or open detailed view
      console.log('Viewing tipsters for user:', userId);
      showToast('Cargando tipsters del usuario...');
      
      // Could open drawer with user-specific tipster data
      // openDrawerByUserId(userId);
    }

    // Cross-navigation functions for support
    function navigateToUser(userId) {
      // Navigate to user profile in admin-users
      window.open(`admin-users.html?userId=${userId}&drawer=1`, '_blank');
      showToast(`Abriendo perfil de usuario: ${userId}`);
    }

    function navigateToFinance(orderId) {
      // Navigate to finance admin with order filter
      window.open(`admin-finance.html?orderId=${orderId}`, '_blank');
      showToast(`Abriendo finanzas para orden: ${orderId}`);
    }

    function navigateToCredits(userId) {
      // Navigate to credits admin with user filter
      window.open(`admin-credits.html?userId=${userId}`, '_blank');
      showToast(`Abriendo cr√©ditos para usuario: ${userId}`);
    }

    function navigateToTipsters(userId) {
      // Navigate to tipsters admin with user filter
      window.open(`admin-tipsters.html?userId=${userId}`, '_blank');
      showToast(`Abriendo tipsters para usuario: ${userId}`);
    }
  </script>

</body>
</html>