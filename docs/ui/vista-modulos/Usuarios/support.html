<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Support Hub | Trading Deportivo</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600;700&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-cyan: #00F5FF;
      --primary-green: #00FF94;
      --primary-blue: #0066FF;
      --secondary-gold: #FFD700;
      --secondary-purple: #B026FF;
      --secondary-red: #FF4444;
      --secondary-orange: #FF8C00;
      --bg-primary: #0A0A1A;
      --bg-secondary: #141428;
      --bg-tertiary: #1E1E38;
      --bg-elevated: #252545;
      --border-primary: #2A2A4A;
      --border-secondary: #3A3A5A;
      --text-primary: #FFFFFF;
      --text-secondary: #B8B8D0;
      --text-muted: #8888A8;
      --sidebar-width: 280px;
      --topbar-height: 70px;
      --gradient-primary: linear-gradient(135deg, #00F5FF 0%, #0066FF 100%);
      --gradient-success: linear-gradient(135deg, #00FF94 0%, #00D970 100%);
      --gradient-premium: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      --gradient-danger: linear-gradient(135deg, #FF4444 0%, #CC0000 100%);
      --glow-cyan: 0 0 20px rgba(0, 245, 255, 0.4);
      --glow-green: 0 0 20px rgba(0, 255, 148, 0.4);
      --glow-gold: 0 0 20px rgba(255, 215, 0, 0.4);
    }

    body {
      font-family: 'Rajdhani', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background-image: 
        linear-gradient(var(--border-primary) 1px, transparent 1px),
        linear-gradient(90deg, var(--border-primary) 1px, transparent 1px);
      background-size: 50px 50px;
      opacity: 0.15;
      z-index: 0;
      pointer-events: none;
      animation: gridFloat 20s ease-in-out infinite;
    }

    @keyframes gridFloat {
      0%, 100% { transform: translateY(0); opacity: 0.1; }
      50% { transform: translateY(-10px); opacity: 0.2; }
    }

    .dashboard {
      display: flex;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }

    /* ========== SIDEBAR ========== */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-primary);
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      z-index: 100;
      overflow-y: auto;
    }

    .sidebar-logo {
      padding: 20px;
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      align-items: center;
      gap: 12px;
      background: linear-gradient(135deg, rgba(0, 245, 255, 0.08), rgba(0, 102, 255, 0.08));
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--gradient-primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      box-shadow: var(--glow-cyan);
    }

    .logo-text {
      font-size: 18px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .sidebar-nav {
      flex: 1;
      padding: 12px 8px;
    }

    .nav-section {
      margin-bottom: 20px;
    }

    .nav-section-title {
      padding: 6px 12px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      margin-bottom: 6px;
      border-radius: 10px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: linear-gradient(135deg, rgba(0, 245, 255, 0.15), rgba(0, 102, 255, 0.15));
      color: var(--primary-cyan);
      border-left: 3px solid var(--primary-cyan);
      box-shadow: 0 0 20px rgba(0, 245, 255, 0.2);
    }

    .nav-icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    /* ========== MAIN CONTENT ========== */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      max-width: calc(100vw - var(--sidebar-width));
    }

    .topbar {
      height: var(--topbar-height);
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-primary);
      padding: 0 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 90;
      backdrop-filter: blur(12px);
    }

    .page-title {
      font-size: 24px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .breadcrumbs {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .content-area {
      flex: 1;
      overflow: auto;
      max-width: 100%;
      height: calc(100vh - var(--topbar-height));
    }

    /* ========== SUPPORT LAYOUT GRID ========== */
    .support-layout {
      display: grid;
      grid-template-columns: 320px 1fr 340px;
      gap: 24px;
      height: 100%;
      min-height: 0;
      padding-bottom: 80px; /* Space for bottom banner */
    }

    .support-inbox {
      overflow-y: auto;
      max-height: 100%;
    }

    .support-chat {
      display: flex;
      flex-direction: column;
      overflow: hidden;
      min-height: 0;
      height: 100%;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      max-height: calc(100vh - 200px); /* Account for header and input */
    }

    .chat-input {
      border-top: 1px solid var(--border);
    }

    /* Context Sidebar */
    .support-context {
      overflow-y: auto;
      min-height: 0;
      max-height: 100%;
    }

    .context-sidebar {
      padding: 16px;
    }

    .context-sidebar h3 {
      margin: 0 0 20px 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .context-section {
      margin-bottom: 24px;
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .context-section h4 {
      margin: 0 0 12px 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .context-section p {
      margin: 8px 0;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .context-section strong {
      color: var(--text-primary);
    }

    /* ========== ALERT ========== */
    .alert {
      padding: 16px;
      border-radius: 12px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 20px;
      font-size: 14px;
      border: 1px solid;
    }

    .alert-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .alert.info {
      background: rgba(0, 245, 255, 0.1);
      border-color: rgba(0, 245, 255, 0.3);
      color: var(--primary-cyan);
    }

    .alert.warning {
      background: rgba(255, 140, 0, 0.1);
      border-color: rgba(255, 140, 0, 0.3);
      color: var(--secondary-orange);
    }

    /* ========== INBOX PANEL ========== */
    .inbox-panel {
      background: var(--bg-secondary);
      border-right: 1px solid var(--border-primary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      height: 100%;
    }

    .inbox-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-primary);
    }

    .inbox-tabs {
      display: flex;
      border-bottom: 1px solid var(--border-primary);
      margin: -20px -20px 20px -20px;
    }

    .tab-btn {
      flex: 1;
      padding: 14px;
      text-align: center;
      font-size: 15px;
      font-weight: 600;
      color: var(--text-muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.3s ease;
    }

    .tab-btn:hover {
      color: var(--text-secondary);
      background: rgba(255, 255, 255, 0.03);
    }

    .tab-btn.active {
      color: var(--primary-cyan);
      border-bottom-color: var(--primary-cyan);
    }

    .inbox-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .inbox-filters {
      display: flex;
      gap: 8px;
    }

    .filter-btn {
      padding: 6px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .filter-btn:hover {
      border-color: var(--primary-cyan);
      color: var(--primary-cyan);
    }

    .filter-btn.active {
      background: rgba(0, 245, 255, 0.15);
      border-color: var(--primary-cyan);
      color: var(--primary-cyan);
    }

    .inbox-list {
      flex: 1;
      overflow-y: auto;
    }

    .conversation-item {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-primary);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .conversation-item:hover {
      background: var(--bg-tertiary);
    }

    .conversation-item.active {
      background: linear-gradient(135deg, rgba(0, 245, 255, 0.08), rgba(0, 102, 255, 0.08));
      border-left: 3px solid var(--primary-cyan);
    }

    .conversation-item.unread {
      background: rgba(0, 245, 255, 0.05);
    }

    .conversation-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }

    .conversation-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }

    .conversation-icon.admin {
      background: linear-gradient(135deg, rgba(0, 245, 255, 0.2), rgba(0, 102, 255, 0.2));
    }

    .conversation-icon.tipster {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.2));
    }

    .conversation-info {
      flex: 1;
      min-width: 0;
    }

    .conversation-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .conversation-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .conversation-chips {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }

    .chip {
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      font-family: 'JetBrains Mono', monospace;
    }

    .chip.solid {
      color: var(--bg-primary);
    }

    .chip.outline {
      border: 1px solid;
      background: transparent;
    }
    
    .chip.ghost {
      background: transparent;
      padding-left: 0;
      padding-right: 0;
    }

    /* Chip Colors */
    .chip.blue { background-color: var(--primary-blue); border-color: var(--primary-blue); color: var(--text-primary); }
    .chip.yellow { background-color: var(--secondary-gold); border-color: var(--secondary-gold); color: var(--bg-primary); }
    .chip.gray { background-color: var(--border-secondary); border-color: var(--border-secondary); color: var(--text-secondary); }
    .chip.green { background-color: var(--primary-green); border-color: var(--primary-green); color: var(--bg-primary); }
    .chip.purple { background-color: var(--secondary-purple); border-color: var(--secondary-purple); color: var(--text-primary); }
    .chip.teal { background-color: #20c997; border-color: #20c997; color: var(--text-primary); }
    .chip.orange { background-color: var(--secondary-orange); border-color: var(--secondary-orange); color: var(--bg-primary); }
    .chip.red { background-color: var(--secondary-red); border-color: var(--secondary-red); color: var(--text-primary); }
    .chip.indigo { background-color: #6610f2; border-color: #6610f2; color: var(--text-primary); }

    .chip.outline.blue { color: var(--primary-blue); }
    .chip.outline.purple { color: var(--secondary-purple); }
    .chip.outline.teal { color: #20c997; }
    .chip.outline.orange { color: var(--secondary-orange); }
    .chip.outline.red { color: var(--secondary-red); }
    .chip.outline.indigo { color: #6610f2; }
    .chip.outline.gray { color: var(--text-muted); }

    .chip.ghost.green { color: var(--primary-green); }
    .chip.ghost.yellow { color: var(--secondary-gold); }
    .chip.ghost.red { color: var(--secondary-red); }

    .status-badge {
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
    }

    .status-badge.open {
      background: rgba(0, 245, 255, 0.2);
      color: var(--primary-cyan);
    }

    .status-badge.awaiting {
      background: rgba(255, 140, 0, 0.2);
      color: var(--secondary-orange);
    }

    .status-badge.resolved {
      background: rgba(0, 255, 148, 0.2);
      color: var(--primary-green);
    }

    .conversation-preview {
      font-size: 13px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-top: 6px;
    }

    .unread-badge {
      position: absolute;
      top: 16px;
      right: 20px;
      min-width: 20px;
      height: 20px;
      padding: 0 6px;
      background: var(--secondary-red);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .new-ticket-btn {
      margin: 16px 20px;
      padding: 12px;
      background: var(--gradient-primary);
      border: none;
      border-radius: 10px;
      color: var(--bg-primary);
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
    }

    .new-ticket-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 102, 255, 0.5);
    }

    /* ========== CHAT VIEW ========== */
    .chat-view {
      display: flex;
      flex-direction: column;
      background: var(--bg-primary);
      overflow: hidden;
      min-height: 0;
      height: 100%;
    }

    .chat-header {
      padding: 16px 24px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .chat-participant {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-shrink: 0;
    }
    
    .chat-header-meta {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-grow: 1;
      justify-content: center;
    }

    .participant-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
    }

    .participant-info h3 {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .participant-role {
      font-size: 12px;
      color: var(--text-muted);
    }

    .chat-actions {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }
    
    .context-pills {
      padding: 12px 24px;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      gap: 12px;
      font-size: 12px;
      flex-wrap: wrap;
      row-gap: 8px;
    }

    .pill {
      padding: 4px 10px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-secondary);
      border-radius: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .pill:hover {
      border-color: var(--primary-cyan);
      color: var(--primary-cyan);
    }

    .action-btn {
      padding: 8px 14px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .action-btn:hover {
      border-color: var(--primary-cyan);
      color: var(--primary-cyan);
    }

    .action-btn.danger:hover {
      border-color: var(--secondary-red);
      color: var(--secondary-red);
    }

    /* ========== MESSAGES ========== */
    .chat-messages {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-width: 100%;
      box-sizing: border-box;
      min-height: 0;
    }

    .message {
      display: flex;
      gap: 12px;
      max-width: 70%;
    }

    .message.user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }

    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--gradient-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      flex-shrink: 0;
    }

    .message-content {
      flex: 1;
    }

    .message-bubble {
      padding: 12px 16px;
      border-radius: 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      line-height: 1.5;
      word-wrap: break-word;
      overflow-wrap: break-word;
      max-width: 100%;
      box-sizing: border-box;
    }

    .message.user .message-bubble {
      background: linear-gradient(135deg, rgba(0, 245, 255, 0.15), rgba(0, 102, 255, 0.15));
      border-color: rgba(0, 245, 255, 0.3);
    }

    .message-bubble.system {
      background: rgba(255, 140, 0, 0.1);
      border-color: rgba(255, 140, 0, 0.3);
      color: var(--secondary-orange);
      font-size: 13px;
      text-align: center;
    }

    .message-time {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .message-attachment {
      margin-top: 8px;
      padding: 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .message-attachment:hover {
      border-color: var(--primary-cyan);
    }

    .attachment-icon {
      width: 36px;
      height: 36px;
      background: rgba(0, 245, 255, 0.1);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .attachment-info {
      flex: 1;
    }

    .attachment-name {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .attachment-size {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* ========== MESSAGE COMPOSER ========== */
    .chat-input {
      padding: 20px 24px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-primary);
      position: sticky;
      bottom: 0;
    }

    .composer-input-wrapper {
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }

    .composer-textarea {
      flex: 1;
      min-height: 44px;
      max-height: 120px;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 10px;
      color: var(--text-primary);
      font-family: 'Rajdhani', sans-serif;
      font-size: 14px;
      resize: none;
      outline: none;
      transition: all 0.3s ease;
    }

    .composer-textarea:focus {
      border-color: var(--primary-cyan);
      box-shadow: 0 0 0 3px rgba(0, 245, 255, 0.1);
    }

    .composer-actions {
      display: flex;
      gap: 8px;
    }

    .composer-btn {
      width: 44px;
      height: 44px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 18px;
    }

    .composer-btn:hover {
      border-color: var(--primary-cyan);
      color: var(--primary-cyan);
    }

    .composer-btn.send {
      background: var(--gradient-primary);
      color: var(--bg-primary);
      box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
    }

    .composer-btn.send:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 102, 255, 0.5);
    }

    /* ========== NEW TICKET MODAL ========== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      width: 90%;
      max-width: 600px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .modal-header {
      padding: 24px;
      background: linear-gradient(135deg, rgba(0, 245, 255, 0.08), rgba(0, 102, 255, 0.08));
      border-bottom: 1px solid var(--border-primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
    }

    .modal-close {
      width: 32px;
      height: 32px;
      background: var(--bg-tertiary);
      border: none;
      border-radius: 6px;
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .modal-close:hover {
      background: var(--bg-elevated);
      color: var(--text-primary);
    }

    .modal-body {
      padding: 24px;
      max-height: 70vh;
      overflow-y: auto;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .form-label .required {
      color: var(--secondary-red);
      margin-left: 4px;
    }

    .form-select,
    .form-input,
    .form-textarea {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 10px;
      color: var(--text-primary);
      font-family: 'Rajdhani', sans-serif;
      font-size: 14px;
      outline: none;
      transition: all 0.3s ease;
    }

    .form-select:focus,
    .form-input:focus,
    .form-textarea:focus {
      border-color: var(--primary-cyan);
      box-shadow: 0 0 0 3px rgba(0, 245, 255, 0.1);
    }

    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }

    .form-help {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .file-upload {
      padding: 24px;
      background: var(--bg-tertiary);
      border: 2px dashed var(--border-primary);
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .file-upload:hover {
      border-color: var(--primary-cyan);
      background: rgba(0, 245, 255, 0.05);
    }

    .file-upload-icon {
      font-size: 36px;
      margin-bottom: 8px;
    }

    .file-upload-text {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .file-upload-limit {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .modal-footer {
      padding: 24px;
      background: var(--bg-tertiary);
      border-top: 1px solid var(--border-primary);
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--border-primary);
      color: var(--text-secondary);
    }

    .btn-outline:hover {
      border-color: var(--primary-cyan);
      color: var(--primary-cyan);
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: var(--bg-primary);
      box-shadow: 0 4px 12px rgba(0, 102, 255, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 102, 255, 0.5);
    }

    /* ========== EMPTY STATE ========== */

    /* ========== RESPONSIVE ========== */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .inbox-panel {
        width: 100%;
      }

      .chat-view {
        display: none;
      }

      .chat-view.active {
        display: flex;
      }

      .message {
        max-width: 85%;
      }
    }

    /* ========== SCROLLBAR ========== */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-primary);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--border-secondary);
    }

    /* ===== ESTILOS PARA FUNCIONES UI/UX NUEVAS ===== */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 48px 24px;
      text-align: center;
      color: var(--text-secondary);
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.6;
    }

    .empty-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .empty-subtitle {
      font-size: 14px;
      margin-bottom: 24px;
      max-width: 300px;
    }



    .chip-icon {
      font-size: 14px;
    }

    .chip-text {
      font-weight: 500;
    }



    .typing-dots {
      display: flex;
      gap: 4px;
    }

    .typing-dots span {
      width: 6px;
      height: 6px;
      background: var(--text-secondary);
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
    }

    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typing {
      0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }

    .activity-text {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Policy Banner - Bottom */
    .policy-banner-bottom {
      position: relative;
      background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
      border-top: 1px solid var(--border-primary);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
      backdrop-filter: blur(10px);
      margin-top: auto;
    }

    .policy-banner-bottom.collapsed {
      display: none;
    }

    .policy-banner-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      gap: 20px;
    }

    .policy-banner-text {
      color: var(--text-secondary);
      font-size: 14px;
      flex: 1;
    }

    .banner-toggle {
      background: var(--primary-cyan);
      border: none;
      color: var(--text-primary);
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .banner-toggle:hover {
      background: var(--primary-cyan-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    /* SLA Card for Context Sidebar */
    .sla-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .sla-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid var(--border-secondary);
    }

    .sla-item:last-child {
      border-bottom: none;
    }

    .sla-label {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .sla-value {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 500;
    }

    .sla-value.priority-high {
      color: var(--status-error);
    }

    .sla-value.priority-medium {
      color: var(--status-warning);
    }

    .sla-value.priority-low {
      color: var(--status-success);
    }

    /* Compliance Grid for Context Sidebar */
    .compliance-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .compliance-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 0;
    }

    .compliance-icon {
      font-size: 16px;
      width: 24px;
      text-align: center;
    }

    .compliance-text {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Comprehensive Policy Modal */
    .policy-modal-content {
      max-width: 900px;
      max-height: 90vh;
      overflow-y: auto;
      background: var(--bg-primary);
      border-radius: 16px;
      border: 1px solid var(--border-primary);
    }

    .policy-modal-body {
      padding: 32px;
    }

    .policy-section {
      margin-bottom: 40px;
    }

    .policy-section h3 {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .policy-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .policy-item {
      background: var(--bg-secondary);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--border-primary);
      transition: all 0.2s ease;
    }

    .policy-item:hover {
      border-color: var(--primary-cyan);
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }

    .policy-item h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .policy-item ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .policy-item li {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 8px;
      padding-left: 16px;
      position: relative;
    }

    .policy-item li::before {
      content: '‚Ä¢';
      color: var(--primary-cyan);
      position: absolute;
      left: 0;
      font-weight: bold;
    }

    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .category-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: 12px;
      border: 1px solid var(--border-primary);
      transition: all 0.2s ease;
    }

    .category-item:hover {
      border-color: var(--primary-cyan);
      transform: translateY(-2px);
    }

    .category-icon {
      font-size: 24px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-tertiary);
      border-radius: 50%;
    }

    .category-item strong {
      display: block;
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 4px;
    }

    .category-item p {
      color: var(--text-secondary);
      font-size: 12px;
      margin: 0;
    }

    .sla-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .sla-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--border-primary);
      transition: all 0.2s ease;
    }

    .sla-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }

    .sla-item.high-priority {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
      border-color: rgba(239, 68, 68, 0.3);
    }

    .sla-item.medium-priority {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
      border-color: rgba(245, 158, 11, 0.3);
    }

    .sla-item.low-priority {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
      border-color: rgba(59, 130, 246, 0.3);
    }

    .sla-icon {
      font-size: 32px;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: var(--bg-tertiary);
    }

    .sla-item strong {
      display: block;
      color: var(--text-primary);
      font-size: 16px;
      margin-bottom: 4px;
    }

    .sla-item p {
      color: var(--text-secondary);
      font-size: 14px;
      margin: 0 0 8px 0;
    }

    .sla-time {
      background: var(--primary-cyan);
      color: var(--text-primary);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .security-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .security-item {
      background: var(--bg-secondary);
      padding: 24px;
      border-radius: 12px;
      border: 1px solid var(--border-primary);
      transition: all 0.2s ease;
    }

    .security-item:hover {
      border-color: var(--primary-cyan);
      transform: translateY(-2px);
    }

    .security-item h4 {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .security-item p {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.6;
      margin: 0;
    }

    /* Empty State */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 48px 24px;
      text-align: center;
      color: var(--text-secondary);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .empty-state-description {
      font-size: 14px;
      color: var(--text-secondary);
      max-width: 300px;
    }

    /* Context Chip */
    .context-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-primary);
      border-radius: 16px;
      padding: 4px 10px;
      font-size: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .context-chip:hover {
      border-color: var(--primary-cyan);
      color: var(--primary-cyan);
    }

    .context-chip.active {
      background: var(--primary-cyan);
      border-color: var(--primary-cyan);
      color: var(--text-primary);
    }

    /* Activity Indicator */
    .activity-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--bg-tertiary);
      border-radius: 20px;
      font-size: 12px;
      color: var(--text-secondary);
      margin: 8px 0;
    }

    .typing-dots {
      display: flex;
      gap: 2px;
    }

    .typing-dot {
      width: 4px;
      height: 4px;
      background: var(--text-secondary);
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typing {
      0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>


  <!-- Comprehensive Policy Modal -->
  <div id="policy-modal" class="modal-overlay">
    <div class="modal-content policy-modal-content">
      <div class="modal-header">
        <h2>üìã Pol√≠ticas de Soporte</h2>
        <button class="modal-close" onclick="closePolicyModal()">&times;</button>
      </div>
      <div class="modal-body policy-modal-body">
        <div class="policy-section">
          <h3>üõü Soporte Administrativo</h3>
          <div class="policy-grid">
            <div class="policy-item">
              <h4>‚è±Ô∏è Tiempos de Respuesta</h4>
              <ul>
                <li><strong>Cuenta y Pagos:</strong> 2-4 horas</li>
                <li><strong>Problemas T√©cnicos:</strong> 4-8 horas</li>
                <li><strong>Preguntas Generales:</strong> 8-24 horas</li>
              </ul>
            </div>
            <div class="policy-item">
              <h4>üîí Seguridad</h4>
              <ul>
                <li>Nunca solicitamos contrase√±as</li>
                <li>Usa solo canales oficiales</li>
                <li>Verifica identidad en temas sensibles</li>
              </ul>
            </div>
            <div class="policy-item">
              <h4>üí∞ Reembolsos</h4>
              <ul>
                <li>Sujetos a pol√≠ticas de la plataforma</li>
                <li>An√°lisis caso por caso</li>
                <li>Plazo m√°ximo: 30 d√≠as</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="policy-section">
          <h3>üí¨ Chat con Tipsters</h3>
          <div class="policy-grid">
            <div class="policy-item">
              <h4>‚ö†Ô∏è Disclaimer Importante</h4>
              <ul>
                <li>Los tipsters NO garantizan resultados</li>
                <li>El trading implica riesgo</li>
                <li>Tus decisiones son tu responsabilidad</li>
              </ul>
            </div>
            <div class="policy-item">
              <h4>üéØ Prop√≥sito del Chat</h4>
              <ul>
                <li>Educaci√≥n y an√°lisis</li>
                <li>Metodolog√≠a y estrategia</li>
                <li>Seguimiento educativo</li>
              </ul>
            </div>
            <div class="policy-item">
              <h4>üö´ Prohibido</h4>
              <ul>
                <li>Solicitar garant√≠as de ganancias</li>
                <li>Compartir se√±ales externas</li>
                <li>Coordinar apuestas manipulativas</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="policy-section">
          <h3>üéØ Categor√≠as de Soporte</h3>
          <div class="category-grid">
            <div class="category-item">
              <span class="category-icon">üîê</span>
              <div>
                <strong>Acceso a Cuenta</strong>
                <p>Login, 2FA, verificaci√≥n</p>
              </div>
            </div>
            <div class="category-item">
              <span class="category-icon">üí≥</span>
              <div>
                <strong>Pagos y Retiros</strong>
                <p>Dep√≥sitos, compras, retiros</p>
              </div>
            </div>
            <div class="category-item">
              <span class="category-icon">üêõ</span>
              <div>
                <strong>Errores T√©cnicos</strong>
                <p>Bugs, fallos del sistema</p>
              </div>
            </div>
            <div class="category-item">
              <span class="category-icon">üë§</span>
              <div>
                <strong>Reportar Usuario</strong>
                <p>Comportamiento inapropiado</p>
              </div>
            </div>
            <div class="category-item">
              <span class="category-icon">‚ùì</span>
              <div>
                <strong>Preguntas</strong>
                <p>Dudas sobre productos</p>
              </div>
            </div>
            <div class="category-item">
              <span class="category-icon">üìã</span>
              <div>
                <strong>Otros</strong>
                <p>Cualquier otro tema</p>
              </div>
            </div>
          </div>
        </div>

        <div class="policy-section">
          <h3>‚ö° SLA y M√©tricas</h3>
          <div class="sla-grid">
            <div class="sla-item high-priority">
              <div class="sla-icon">üö®</div>
              <div>
                <strong>Alta Prioridad</strong>
                <p>Cuenta, Pagos</p>
                <span class="sla-time">2-4 horas</span>
              </div>
            </div>
            <div class="sla-item medium-priority">
              <div class="sla-icon">‚ö†Ô∏è</div>
              <div>
                <strong>Media Prioridad</strong>
                <p>Errores, Reportes</p>
                <span class="sla-time">4-8 horas</span>
              </div>
            </div>
            <div class="sla-item low-priority">
              <div class="sla-icon">üìã</div>
              <div>
                <strong>Baja Prioridad</strong>
                <p>Preguntas generales</p>
                <span class="sla-time">8-24 horas</span>
              </div>
            </div>
          </div>
        </div>

        <div class="policy-section">
          <h3>üõ°Ô∏è Seguridad y Compliance</h3>
          <div class="security-grid">
            <div class="security-item">
              <h4>üîê Protecci√≥n de Datos</h4>
              <p>Todas las conversaciones est√°n encriptadas y auditadas. Cambios quedan registrados.</p>
            </div>
            <div class="security-item">
              <h4>üö´ Anti-Spam</h4>
              <p>Rate limiting autom√°tico. Violaciones pueden resultar en suspensi√≥n temporal.</p>
            </div>
            <div class="security-item">
              <h4>üìä Monitoreo</h4>
              <p>Detecci√≥n autom√°tica de patrones sospechosos y comportamientos inapropiados.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <div class="logo-icon">TD</div>
        <div class="logo-text">Trader Deportivo</div>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Inteligencia</div>
          <a href="/dashboard" class="nav-item">
            <span class="nav-icon">üìä</span>
            <span>Dashboard</span>
          </a>
          <a href="/agents" class="nav-item">
            <span class="nav-icon">üß†</span>
            <span>Agents Hub</span>
          </a>
          <a href="/signals" class="nav-item">
            <span class="nav-icon">üì°</span>
            <span>Se√±ales</span>
          </a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Capital & Control</div>
          <a href="/bankroll" class="nav-item">
            <span class="nav-icon">üí∞</span>
            <span>Bankroll</span>
          </a>
          <a href="/watchlist" class="nav-item">
            <span class="nav-icon">üëÅÔ∏è</span>
            <span>Watchlist</span>
          </a>
          <a href="/risk" class="nav-item">
            <span class="nav-icon">üö®</span>
            <span>Risk Guard</span>
          </a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Comunidad</div>
          <a href="/community" class="nav-item">
            <span class="nav-icon">üèÜ</span>
            <span>Community Hub</span>
          </a>
          <a href="/support" class="nav-item active">
            <span class="nav-icon">üõü</span>
            <span>Support Hub</span>
          </a>
          <a href="/store" class="nav-item">
            <span class="nav-icon">üíé</span>
            <span>Tienda</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Topbar -->
      <header class="topbar">
        <div>
          <h1 class="page-title">üõü Support Hub</h1>
          <div class="breadcrumbs">
            <span>Inicio</span>
            <span>‚Ä∫</span>
            <span>Soporte</span>
            <span>‚Ä∫</span>
            <span>Support Hub</span>
          </div>
        </div>
      </header>

      <!-- Content Area -->
      <section class="content-area">
        <div class="support-layout">
          <!-- Inbox Panel -->
          <div class="support-inbox">
            <div class="inbox-panel">
          <div class="inbox-header">
            <div class="inbox-tabs">
              <div class="tab-btn active" onclick="switchTab('support')">üõü Soporte</div>
              <div class="tab-btn" onclick="switchTab('tipsters')">üí¨ Tipsters</div>
              <div class="tab-btn" onclick="switchTab('coaching')">üéì Coaching</div>
            </div>
            <h2 class="inbox-title">Tickets de Soporte</h2>
            <div class="inbox-filters">
              <button class="filter-btn active">Todos</button>
              <button class="filter-btn">Abiertos</button>
              <button class="filter-btn">En espera</button>
            </div>
          </div>

          <div class="inbox-list">
            <!-- Conversation 1: Admin Support - Active -->
            <div class="conversation-item active unread" data-tab="support">
              <div class="conversation-header">
                <div class="conversation-icon admin">üõü</div>
                <div class="conversation-info">
                  <div class="conversation-title">Pago pendiente #A1B2</div>
                  <div class="conversation-meta">
                    <span class="status-badge awaiting">Awaiting Admin</span>
                    <span>‚Ä¢</span>
                    <span>Hace 2h</span>
                  </div>
                </div>
                <div class="unread-badge">2</div>
              </div>
              <div class="conversation-preview">
                Envi√© el pago hace 3 horas pero a√∫n no se acredita...
              </div>
              <div class="conversation-chips">
                <div class="chip ghost yellow">Status: Awaiting Admin</div>
                <div class="chip outline orange">Category: Payments</div>
                <div class="chip ghost yellow">SLA: Risk</div>
              </div>
            </div>

            <!-- Conversation 2: Tipster Chat -->
            <div class="conversation-item" data-tab="tipsters" style="display: none;">
              <div class="conversation-header">
                <div class="conversation-icon tipster">üí¨</div>
                <div class="conversation-info">
                  <div class="conversation-title">Chat: JuanMart√≠nez</div>
                  <div class="conversation-meta">
                    <span>Hace 5h</span>
                  </div>
                </div>
              </div>
              <div class="conversation-preview">
                Gracias por la aclaraci√≥n sobre el an√°lisis del Liverpool...
              </div>
            </div>

            <!-- Conversation: Coaching -->
            <div class="conversation-item" data-tab="coaching" style="display: none;">
              <div class="conversation-header">
                <div class="conversation-icon tipster">üéì</div>
                <div class="conversation-info">
                  <div class="conversation-title">Coaching: Revisi√≥n de banca</div>
                  <div class="conversation-meta">
                    <span>Hoy</span>
                  </div>
                </div>
                <span class="chip ghost green">Coach</span>
              </div>
              <div class="conversation-preview">
                ¬øTe ayudamos a ajustar stake y mercados para reducir la varianza?
              </div>
              <div class="conversation-chips">
                <div class="chip outline teal">Tipo: Coaching</div>
                <div class="chip ghost yellow">Retenci√≥n</div>
              </div>
            </div>

            <!-- Conversation 3: Admin Support - Resolved -->
            <div class="conversation-item" data-tab="support">
              <div class="conversation-header">
                <div class="conversation-icon admin">üõü</div>
                <div class="conversation-info">
                  <div class="conversation-title">Problema de login #C3D4</div>
                  <div class="conversation-meta">
                    <span class="status-badge resolved">Resolved</span>
                    <span>‚Ä¢</span>
                    <span>Ayer</span>
                  </div>
                </div>
              </div>
              <div class="conversation-preview">
                Ticket marcado como resuelto. ¬øTe ayud√≥ la respuesta?
              </div>
              <div class="conversation-chips">
                <div class="chip ghost green">Status: Resolved</div>
                <div class="chip outline indigo">Category: Account</div>
                <div class="chip ghost green">SLA: OK</div>
              </div>
            </div>

            <!-- Conversation 4: Admin Support - Open -->
            <div class="conversation-item" data-tab="support">
              <div class="conversation-header">
                <div class="conversation-icon admin">üõü</div>
                <div class="conversation-info">
                  <div class="conversation-title">Bug en Watchlist #E5F6</div>
                  <div class="conversation-meta">
                    <span class="status-badge open">Open</span>
                    <span>‚Ä¢</span>
                    <span>Hace 1 d√≠a</span>
                  </div>
                </div>
              </div>
              <div class="conversation-preview">
                Nuestro equipo t√©cnico est√° investigando...
              </div>
              <div class="conversation-chips">
                <div class="chip ghost blue">Status: Open</div>
                <div class="chip outline red">Category: Bug</div>
                <div class="chip ghost green">SLA: OK</div>
              </div>
            </div>

            <!-- Empty State (hidden by default) -->
            <div class="empty-state" id="emptyState" style="display: none;">
              <div class="empty-state-icon">üì≠</div>
              <div class="empty-state-title">Sin conversaciones</div>
              <div class="empty-state-description">No tienes conversaciones activas en este momento. Crea un nuevo ticket para comenzar.</div>
            </div>
          </div>

          <button class="new-ticket-btn" onclick="openNewTicketModal()">
            <span>‚ûï</span>
            <span>Nuevo Ticket</span>
          </button>
          </div>
          </div>

          <!-- Chat View -->
          <div class="support-chat">
            <div class="chat-view">
          <!-- Chat Header -->
          <div class="chat-header">
            <div class="chat-participant">
              <div class="participant-avatar">üõü</div>
              <div class="participant-info">
                <h3>Soporte ‚Äî Pago pendiente #A1B2</h3>
                <div class="participant-role">Admin Support ‚Ä¢ Awaiting Admin</div>
                <div class="agent-status" style="font-size:12px; color: var(--text-secondary);">
                  <span style="color: var(--primary-green);">‚óè</span> En l√≠nea ‚Ä¢ Responde normalmente en < 10 min ‚Ä¢ √öltima actividad: 2h
                </div>
              </div>
            </div>
            <div class="chat-header-meta">
              <span class="chip outline indigo" id="conversationTypeChip">Tipo: Soporte t√©cnico</span>
              <span class="chip outline teal" id="slaChip">SLA: 30 min</span>
              <span class="chip outline gray" id="agentStatusChip">‚óè En l√≠nea</span>
            </div>
            <div class="chat-actions">
              <button class="action-btn" onclick="openModal('resolveRatingModal')">‚úì Marcar como resuelto</button>
              <button class="action-btn" onclick="openModal('closeTicketModal')">Cerrar</button>
              <button class="action-btn" onclick="openModal('escalateTicketModal')">Escalar</button>
              <button class="action-btn danger" onclick="openModal('reportMessageModal')">Reportar</button>
            </div>
          </div>

          <div class="context-pills">
            <span class="pill" onclick="openContext('purchase')">üîó Ver compra #A1B2</span>
            <div class="context-chip active" onclick="renderContextChip('purchase')">üí∞ Compra #A1B2</div>
            <div class="context-chip" onclick="renderContextChip('user')">üë§ Usuario: Juan P.</div>
            <div class="context-chip" onclick="renderContextChip('payment')">üí≥ Pago USDT</div>
            <span class="pill" onclick="openContext('withdraw')">üí∏ Ver retiro #R9Z1</span>
            <span class="pill" onclick="openContext('pick')">üìà Ver pick #PICK-204</span>
            <span class="pill" onclick="openContext('post')">üö® Ver post reportado #POST-778</span>
            <span class="pill" onclick="openContext('watchlist')">üëÅÔ∏è Ir a Watchlist</span>
            <span class="pill" onclick="openContext('signal')">üì£ Abrir se√±al</span>
          </div>
          <div class="sla-banner" style="margin: 8px 24px; padding: 10px; background: rgba(0,245,255,0.08); border:1px solid rgba(0,245,255,0.3); border-radius:8px; font-size:13px;">
            <strong>Tiempo estimado de respuesta:</strong> <span id="slaTime">30 minutos</span> ‚Ä¢ <strong>Prioridad:</strong> <span id="slaPriority">Alta</span>
          </div>
          
          <!-- Activity Indicator -->
          <div class="activity-indicator" style="display:none;">
            <div class="typing-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <span class="activity-text">Escribiendo...</span>
          </div>
          
          <div class="alert success ticket-resolved-banner" style="display:none; margin: 8px 24px;">
            <span class="alert-icon">‚úÖ</span>
            <div>Ticket marcado como resuelto. Gracias por tu feedback.</div>
          </div>

          <!-- Internal Note (admin) -->
          <div class="internal-note" style="margin: 0 24px; display: none;">
            <div class="internal-note-header" onclick="toggleInternalNote()" style="display:flex; align-items:center; justify-content:space-between; cursor:pointer; padding:12px; background: var(--bg-tertiary); border:1px solid var(--border-primary); border-radius:8px;">
              <div>üìù Nota interna (admin) <span class="chip outline gray" style="margin-left:8px;">Solo admin</span></div>
              <svg width="16" height="16" style="transition: transform 0.2s;"><path d="M4 6l4 4 4-4" stroke="currentColor" stroke-width="2" fill="none"/></svg>
            </div>
            <div class="internal-note-content" style="display:none; padding:12px; background: var(--bg-tertiary); border:1px solid var(--border-primary); border-top:none; border-radius:0 0 8px 8px;">
              <textarea class="form-textarea" placeholder="A√±ade una nota interna visible solo para admins/mods..." style="min-height:80px;"></textarea>
              <div style="margin-top:8px; display:flex; gap:8px;">
                <button class="btn btn-outline" onclick="toggleInternalNote()">Cerrar</button>
                <button class="btn btn-primary" disabled>Guardar (mock)</button>
              </div>
              <div style="margin-top:12px; display:flex; align-items:center; gap:8px;">
                <span id="internalSentimentChip" class="chip outline purple" style="display:none;">Sentimiento: normal</span>
                <span id="sentimentBadge" class="chip outline purple">normal</span>
                <span class="chip ghost gray">Panel Admin</span>
              </div>
              <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
                <button class="btn btn-outline" onclick="createSystemTicket('losing_streak')">Auto Ticket: Racha</button>
                <button class="btn btn-outline" onclick="createSystemTicket('inactivity')">Auto Ticket: Inactividad</button>
                <button class="btn btn-outline" onclick="createSystemTicket('ignoring_signals')">Auto Ticket: Dudas</button>
                <button class="btn btn-outline" onclick="triggerRiskGuardAutoMessage('stake alto')">Risk Guard: Pausa</button>
              </div>
              <div class="admin-user-summary" style="margin-top:12px; padding:12px; background: var(--bg-secondary); border:1px solid var(--border-primary); border-radius:8px;">
                <div style="display:flex; align-items:center; justify-content:space-between;">
                  <strong>Resumen del usuario</strong>
                  <button class="btn btn-outline" onclick="refreshUserSummary()">Actualizar</button>
                </div>
                <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:8px; margin-top:8px; font-size:13px;">
                  <div>ROI 7d: <strong id="metric_roi7d">‚Äî</strong></div>
                  <div>Picks: <strong id="metric_picks">‚Äî</strong></div>
                  <div>Racha: <strong id="metric_streak">‚Äî</strong></div>
                  <div>CLV: <strong id="metric_clv">‚Äî</strong></div>
                  <div>Mercados: <strong id="metric_markets">‚Äî</strong></div>
                  <div>Riesgo: <strong id="metric_risk">‚Äî</strong></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Eligibility rules (Tipsters) -->
          <div class="eligibility-card" style="display:none; margin: 16px 24px; padding:12px; background: rgba(255, 165, 0, 0.08); border:1px solid rgba(255, 165, 0, 0.3); border-radius:8px;">
            <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
              <span>üìú</span>
              <strong>Reglas de acceso al chat con Tipster</strong>
              <span class="chip ghost red" style="margin-left:auto;">No elegible</span>
            </div>
            <ul style="margin-left:18px; color: var(--text-secondary);">
              <li>Seguir al tipster</li>
              <li>Compra reciente o suscripci√≥n activa</li>
              <li>Sin bloqueos ni flags activos</li>
            </ul>
            <div style="margin-top:8px; font-size:12px; color: var(--text-muted);">Acceso soft: puedes escribir, pero el tipster podr√≠a no responder si no cumples las reglas.</div>
          </div>
          <div class="coaching-card" style="display:none; margin: 16px 24px; padding:12px; background: rgba(0, 123, 255, 0.08); border:1px solid rgba(0, 123, 255, 0.3); border-radius:8px;">
            <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
              <span>üéì</span>
              <strong>Programa de Coaching</strong>
              <span class="chip ghost blue" style="margin-left:auto;">Coach</span>
            </div>
            <ul style="margin-left:18px; color: var(--text-secondary);">
              <li>Mejora tu gesti√≥n de banca</li>
              <li>Define tu estrategia por mercados</li>
              <li>Revisi√≥n de picks y ejecuci√≥n</li>
            </ul>
            <div style="margin-top:8px; font-size:12px; color: var(--text-muted);">Objetivo: retenci√≥n y progreso sostenido.</div>
          </div>

          <!-- Close/Escale/Report Modals (mock) -->
          <div class="modal-overlay" id="closeTicketModal">
            <div class="modal">
              <div class="modal-header">
                <h3 class="modal-title">Confirmar cerrar ticket</h3>
                <button class="modal-close" onclick="closeModal('closeTicketModal')">‚úï</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label class="form-label">Motivo</label>
                  <select class="form-select">
                    <option value="resolved">Resuelto</option>
                    <option value="duplicate">Duplicado</option>
                    <option value="invalid">Inv√°lido</option>
                  </select>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('closeTicketModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="closeModal('closeTicketModal')">Cerrar (mock)</button>
              </div>
            </div>
          </div>

          <div class="modal-overlay" id="escalateTicketModal">
            <div class="modal">
              <div class="modal-header">
                <h3 class="modal-title">Escalar ticket</h3>
                <button class="modal-close" onclick="closeModal('escalateTicketModal')">‚úï</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label class="form-label">√Årea</label>
                  <select class="form-select">
                    <option value="payments">Pagos</option>
                    <option value="withdrawals">Retiros</option>
                    <option value="critical_bug">Bug cr√≠tico</option>
                  </select>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('escalateTicketModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="closeModal('escalateTicketModal')">Escalar (mock)</button>
              </div>
            </div>
          </div>

          <div class="modal-overlay" id="reportMessageModal">
            <div class="modal">
              <div class="modal-header">
                <h3 class="modal-title">Reportar</h3>
                <button class="modal-close" onclick="closeModal('reportMessageModal')">‚úï</button>
              </div>
              <div class="modal-body">
                <div class="form-group">
                  <label class="form-label">Motivo</label>
                  <select class="form-select">
                    <option value="spam">Spam</option>
                    <option value="abuse">Abuso</option>
                    <option value="phishing">Phishing</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Comentario (opcional)</label>
                  <textarea class="form-textarea" placeholder="Describe brevemente el incidente"></textarea>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('reportMessageModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="closeModal('reportMessageModal')">Enviar reporte (mock)</button>
              </div>
            </div>
          </div>

          <div class="modal-overlay" id="resolveRatingModal">
            <div class="modal">
              <div class="modal-header">
                <h3 class="modal-title">¬øTe ayud√≥ esta respuesta?</h3>
                <button class="modal-close" onclick="closeModal('resolveRatingModal')">‚úï</button>
              </div>
              <div class="modal-body" style="text-align:center;">
                <div id="ratingStars" style="font-size:24px; display:flex; gap:8px; justify-content:center;">
                  <span data-star="1" onclick="setRating(1)" title="1">‚≠ê</span>
                  <span data-star="2" onclick="setRating(2)" title="2">‚≠ê</span>
                  <span data-star="3" onclick="setRating(3)" title="3">‚≠ê</span>
                  <span data-star="4" onclick="setRating(4)" title="4">‚≠ê</span>
                  <span data-star="5" onclick="setRating(5)" title="5">‚≠ê</span>
                </div>
                <div style="margin-top:12px;">
                  <textarea id="ratingComment" class="form-textarea" placeholder="Opcional: cu√©ntanos m√°s"></textarea>
                </div>
              </div>
              <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('resolveRatingModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="submitResolutionRating()">Enviar valoraci√≥n (mock)</button>
              </div>
            </div>
          </div>

          <!-- Messages Container -->
          <div class="chat-messages">
            <div class="alert warning tipster-disclaimer" style="display: none;">
              <span class="alert-icon">‚ö†Ô∏è</span>
              <div>
                <strong>Aviso Legal:</strong> Los tipsters no garantizan resultados. El trading deportivo implica riesgo. Toda decisi√≥n de inversi√≥n es responsabilidad del usuario.
              </div>
            </div>
            <!-- Security Moderation: Flagged message -->
            <div class="message">
              <div class="message-content" style="align-self: center; max-width: 100%;">
                <div class="message-bubble system">
                  üö´ Mensaje oculto por seguridad. Motivo: posible phishing. Si crees que fue un error, usa "Reportar" para revisi√≥n.
                </div>
              </div>
            </div>
            <!-- System Message: Ticket Created -->
            <div class="message">
              <div class="message-content" style="align-self: center; max-width: 100%;">
                <div class="message-bubble system">
                  ‚úÖ Ticket #A1B2 creado. Te responderemos pronto.
                </div>
              </div>
            </div>

            <!-- User Message 1 -->
            <div class="message user">
              <div class="message-avatar">TU</div>
              <div class="message-content">
                <div class="message-bubble">
                  Hola, realic√© un pago de 49.99 USDT para el Plan Pro hace 3 horas pero a√∫n no se acredita en mi cuenta.
                  
                  <div class="message-attachment">
                    <div class="attachment-icon">üìÑ</div>
                    <div class="attachment-info">
                      <div class="attachment-name">comprobante_pago.png</div>
                      <div class="attachment-size">1.2 MB</div>
                    </div>
                    <div style="color: var(--primary-cyan); font-size: 18px;">‚¨á</div>
                  </div>
                </div>
                <div class="message-time">Hoy a las 14:30</div>
              </div>
            </div>

            <!-- Admin Message 1 -->
            <div class="message">
              <div class="message-avatar">üõü</div>
              <div class="message-content">
                <div class="message-bubble">
                  Hola! Gracias por contactarnos. Estoy revisando tu pago ahora mismo.
                  
                  ¬øPodr√≠as compartirme el Transaction Hash de tu pago en la red BEP20?
                </div>
                <div class="message-time">Hoy a las 14:35</div>
              </div>
            </div>

            <!-- System Message: Status Changed -->
            <div class="message">
              <div class="message-content" style="align-self: center; max-width: 100%;">
                <div class="message-bubble system">
                  üîÑ Estado cambiado a: Awaiting User
                </div>
              </div>
            </div>

            <!-- User Message 2 -->
            <div class="message user">
              <div class="message-avatar">TU</div>
              <div class="message-content">
                <div class="message-bubble">
                  Claro! El TX hash es: <br>
                  <code style="background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 4px; font-family: 'JetBrains Mono', monospace; font-size: 12px; word-break: break-all; max-width: 100%; display: inline-block;">0x7a8f9b2c1d3e4f5a6b7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a</code>
                </div>
                <div class="message-time">Hoy a las 16:20</div>
              </div>
            </div>

            <!-- System Message: Status Changed -->
            <div class="message">
              <div class="message-content" style="align-self: center; max-width: 100%;">
                <div class="message-bubble system">
                  üîÑ Estado cambiado a: Awaiting Admin
                </div>
              </div>
            </div>
          </div>

          <!-- Message Composer -->
          <div class="chat-input">
            <div class="composer-input-wrapper">
              <textarea 
                class="composer-textarea" 
                placeholder="Escribe tu mensaje..."
                rows="1"
                onkeydown="handleComposerKeydown(event)"
              ></textarea>
              <div class="composer-actions">
                <button class="composer-btn" title="Adjuntar archivo">üìé</button>
                <button class="composer-btn send" onclick="sendMessage()" title="Enviar">
                  <span>‚û§</span>
                </button>
              </div>
            </div>
          </div>
          </div>
          </div>

          <!-- Context Sidebar -->
          <div class="support-context">
            <div class="context-sidebar">
              <h3>Contexto del Ticket</h3>
              <div class="context-section">
                <h4>Informaci√≥n del Usuario</h4>
                <p><strong>Nombre:</strong> Juan P.</p>
                <p><strong>Email:</strong> juan@example.com</p>
                <p><strong>Plan:</strong> Pro</p>
              </div>
              <div class="context-section">
                <h4>Historial del Ticket</h4>
                <p><strong>Estado:</strong> Pendiente</p>
                <p><strong>Prioridad:</strong> Alta</p>
                <p><strong>Creado:</strong> Hace 3 horas</p>
              </div>
              <div class="context-section">
                <h4>SLA y Categor√≠a</h4>
                <div class="sla-card">
                  <div class="sla-item">
                    <span class="sla-label">Prioridad:</span>
                    <span class="sla-value priority-high">Alta</span>
                  </div>
                  <div class="sla-item">
                    <span class="sla-label">Tiempo de respuesta:</span>
                    <span class="sla-value">2-4 horas</span>
                  </div>
                  <div class="sla-item">
                    <span class="sla-label">Categor√≠a:</span>
                    <span class="sla-value">Acceso a cuenta</span>
                  </div>
                </div>
              </div>
              <div class="context-section">
                <h4>Compliance</h4>
                <div class="compliance-grid">
                  <div class="compliance-item">
                    <span class="compliance-icon">üîí</span>
                    <span class="compliance-text">Encriptado</span>
                  </div>
                  <div class="compliance-item">
                    <span class="compliance-icon">üìã</span>
                    <span class="compliance-text">Auditado</span>
                  </div>
                  <div class="compliance-item">
                    <span class="compliance-icon">üõ°Ô∏è</span>
                    <span class="compliance-text">Anti-Spam</span>
                  </div>
                </div>
              </div>
              <div class="context-section">
                <h4>Acciones R√°pidas</h4>
                <button class="btn btn-outline">Ver Compra</button>
                <button class="btn btn-outline">Ver Usuario</button>
                <button class="btn btn-outline">Ver Pago</button>
              </div>
            </div>
          </div>
        </div>
</section>
    </main>
  </div>

  <!-- Policy Banner - Bottom -->
  <div id="policy-banner" class="policy-banner-bottom">
    <div class="policy-banner-content">
      <div class="policy-banner-text">
        <strong>Pol√≠ticas de Soporte:</strong> No compartas claves, contrase√±as ni datos personales sensibles en este chat. Nuestro equipo nunca te los pedir√°.
      </div>
      <button class="banner-toggle" onclick="showPolicyModal()">Ver pol√≠ticas completas</button>
    </div>
  </div>

  <!-- New Ticket Modal -->
  <div class="modal-overlay" id="newTicketModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Crear Nuevo Ticket</h3>
        <button class="modal-close" onclick="closeNewTicketModal()">‚úï</button>
      </div>

      <div class="modal-body">
        <!-- Info Alert -->
        <div class="alert info" style="margin-bottom: 24px;">
          <span class="alert-icon">üí°</span>
          <div style="font-size: 13px;">
            <strong>Antes de crear un ticket:</strong><br>
            ‚Ä¢ Revisa las FAQ<br>
            ‚Ä¢ Describe el problema claramente<br>
            ‚Ä¢ Adjunta capturas si es necesario
          </div>
        </div>
        <div style="margin-bottom:8px;">
          <button class="btn btn-outline" onclick="toggleHelpCenterPanel()">Centro de Ayuda</button>
        </div>
        <div class="help-center" id="helpCenterPanel" style="display:none; margin-bottom:16px; padding:12px; background: var(--bg-tertiary); border:1px solid var(--border-primary); border-radius:8px;">
          <div style="font-weight:600; margin-bottom:8px;">¬øNecesitas ayuda r√°pida?</div>
          <ul style="margin-left:18px;">
            <li><a href="http://localhost:8123/store.html" target="_blank">Pagos y compras</a></li>
            <li><a href="http://localhost:8123/risk-guard.html" target="_blank">Retiros y Risk Guard</a></li>
            <li><a href="http://localhost:8123/watchlist.html#signals" target="_blank">Se√±ales y ejecuci√≥n</a></li>
            <li><a href="http://localhost:8123/community.html" target="_blank">Reportes y comunidad</a></li>
          </ul>
        </div>

        <form id="newTicketForm">
          <!-- Category -->
          <div class="form-group">
            <label class="form-label">
              Categor√≠a
              <span class="required">*</span>
            </label>
            <select class="form-select" required>
              <option value="">Selecciona una categor√≠a</option>
              <option value="account_access">Acceso a cuenta (Login, 2FA)</option>
              <option value="payments">Pagos y compras</option>
              <option value="withdrawals">Retiros</option>
              <option value="technical_bug">Bug t√©cnico</option>
              <option value="report_user">Reportar usuario</option>
              <option value="product_question">Pregunta sobre producto</option>
              <option value="other">Otro</option>
            </select>
          </div>

          <!-- Priority -->
          <div class="form-group">
            <label class="form-label">Prioridad</label>
            <select class="form-select">
              <option value="normal">Normal</option>
              <option value="high">Alta (solo problemas cr√≠ticos)</option>
            </select>
          </div>

          <!-- Subject -->
          <div class="form-group">
            <label class="form-label">
              Asunto
              <span class="required">*</span>
            </label>
            <input 
              type="text" 
              class="form-input" 
              placeholder="Describe brevemente el problema"
              maxlength="100"
              required
            />
            <div class="form-help">M√°ximo 100 caracteres</div>
          </div>

          <!-- Description -->
          <div class="form-group">
            <label class="form-label">
              Descripci√≥n
              <span class="required">*</span>
            </label>
            <textarea 
              class="form-textarea" 
              placeholder="Describe el problema en detalle. Incluye pasos para reproducirlo si es un bug."
              maxlength="2000"
              required
            ></textarea>
            <div class="form-help">M√≠nimo 20 caracteres, m√°ximo 2000</div>
          </div>

          <!-- Attachments -->
          <div class="form-group">
            <label class="form-label">Adjuntos (opcional)</label>
            <div class="file-upload">
              <div class="file-upload-icon">üìé</div>
              <div class="file-upload-text">
                Click para adjuntar archivos
              </div>
              <div class="file-upload-limit">
                PNG, JPG, PDF ‚Ä¢ M√°x 3 archivos ‚Ä¢ 10MB cada uno
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeNewTicketModal()">
          Cancelar
        </button>
        <button class="btn btn-primary" onclick="submitNewTicket()">
          Crear Ticket
        </button>
      </div>
    </div>
  </div>

  <script>
    // New Ticket Modal
    const MESSAGE_LIMIT_PER_MIN = 5;
    const NEW_TICKET_COOLDOWN_MS = 5 * 60 * 1000; // 5 minutos
    const TEMP_BLOCK_MINUTES = 15;
    const ABUSE_INFRACTION_THRESHOLD = 2;
    let messageTimestamps = [];
    let rateLimitInfractions = 0;
    let blockedUntilTs = 0;
    let lastTicketCreatedTs = 0;
    let currentRating = 0;

    function now() { return Date.now(); }
    function minutes(ms) { return Math.ceil(ms / 60000); }

    function showSystemNotice(text) {
      const messagesContainer = document.querySelector('.chat-messages');
      const messageEl = document.createElement('div');
      messageEl.className = 'message';
      messageEl.innerHTML = `
        <div class="message-avatar">‚ö†Ô∏è</div>
        <div class="message-content">
          <div class="message-bubble system">${text}</div>
          <div class="message-time">Sistema</div>
        </div>
      `;
      messagesContainer.appendChild(messageEl);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function toggleHelpCenterPanel() {
      const panel = document.getElementById('helpCenterPanel');
      if (!panel) return;
      panel.style.display = (panel.style.display === 'none' || panel.style.display === '') ? 'block' : 'none';
    }

    function openContext(action) {
      const baseDocs = 'http://localhost:8123/';
      const map = {
        purchase: baseDocs + 'store.html',
        withdraw: baseDocs + 'risk-guard.html',
        pick: baseDocs + 'dashboard_profesional.html',
        post: baseDocs + 'community.html',
        watchlist: baseDocs + 'watchlist.html',
        signal: baseDocs + 'watchlist.html#signals'
      };
      const url = map[action];
      if (url) {
        window.open(url, '_blank');
      } else {
        showSystemNotice('Acci√≥n no disponible actualmente.');
      }
    }

    // Update references to use new class names
    function updateClassReferences() {
      // Update any remaining references in the code
      const oldComposer = document.querySelector('.message-composer');
      if (oldComposer) {
        oldComposer.classList.add('chat-input');
        oldComposer.classList.remove('message-composer');
      }
      
      const oldMessages = document.querySelector('.messages-container');
      if (oldMessages) {
        oldMessages.classList.add('chat-messages');
        oldMessages.classList.remove('messages-container');
      }
    }

    function updateConversationTypeAndSLA(isTipsterOrTab) {
      const typeChip = document.getElementById('conversationTypeChip');
      const slaChip = document.getElementById('slaChip');
      const agentStatusChip = document.getElementById('agentStatusChip');
      const slaBanner = document.querySelector('.sla-banner');
      const slaTimeEl = document.getElementById('slaTime');
      const slaPriorityEl = document.getElementById('slaPriority');
      const tab = typeof isTipsterOrTab === 'boolean' ? (isTipsterOrTab ? 'tipsters' : 'support') : isTipsterOrTab;
      if (tab === 'tipsters') {
        if (typeChip) typeChip.textContent = 'Tipo: Asesor√≠a tipster';
        if (slaChip) slaChip.textContent = 'Sin SLA';
        if (agentStatusChip) agentStatusChip.textContent = '‚óè En l√≠nea';
        if (slaBanner) slaBanner.innerHTML = '<strong>Sin SLA</strong> ‚Äî objetivo: engagement y retenci√≥n';
      } else if (tab === 'coaching') {
        if (typeChip) typeChip.textContent = 'Tipo: Tu Entrenador de Trading';
        if (slaChip) slaChip.textContent = 'SLA: 24h';
        if (agentStatusChip) agentStatusChip.textContent = '‚óè Coach disponible';
        if (slaBanner) slaBanner.innerHTML = '<strong>Tiempo estimado de respuesta:</strong> <span id="slaTime">24 horas</span> ‚Ä¢ <strong>Prioridad:</strong> <span id="slaPriority">Media</span>';
      } else {
        if (typeChip) typeChip.textContent = 'Tipo: Soporte t√©cnico';
        if (slaChip) slaChip.textContent = 'SLA: 30 min';
        if (agentStatusChip) agentStatusChip.textContent = '‚óè En l√≠nea';
        if (slaBanner) {
          if (slaTimeEl) slaTimeEl.textContent = '30 minutos';
          if (slaPriorityEl) slaPriorityEl.textContent = 'Alta';
          slaBanner.innerHTML = '<strong>Tiempo estimado de respuesta:</strong> <span id="slaTime">30 minutos</span> ‚Ä¢ <strong>Prioridad:</strong> <span id="slaPriority">Alta</span>';
        }
      }
    }

    function openNewTicketModal() {
      const nowTs = now();
      if (lastTicketCreatedTs && (nowTs - lastTicketCreatedTs) < NEW_TICKET_COOLDOWN_MS) {
        const waitMin = minutes(NEW_TICKET_COOLDOWN_MS - (nowTs - lastTicketCreatedTs));
        showSystemNotice(`Cooldown activo para nuevos tickets. Vuelve a intentarlo en ~${waitMin} min.`);
        return;
      }
      document.getElementById('newTicketModal').classList.add('active');
    }

    function closeNewTicketModal() {
      document.getElementById('newTicketModal').classList.remove('active');
    }

    function submitNewTicket() {
      // Validate form
      const form = document.getElementById('newTicketForm');
      if (!form.checkValidity()) {
        alert('Por favor completa todos los campos requeridos');
        return;
      }
      // Read inputs
      const subject = form.querySelector('input.form-input')?.value || '';
      const description = form.querySelector('textarea.form-textarea')?.value || '';
      const sentiment = classifySentiment(subject, description);

      lastTicketCreatedTs = now();
      // Submit ticket (mock)
      console.log('Creating new ticket...', { sentiment });
      closeNewTicketModal();
      
      // Show success message
      showSystemNotice('‚úÖ Ticket creado exitosamente. Te responderemos pronto.');
      // Update internal sentiment chip
      setInternalSentiment(sentiment);
    }

    // Helpers ‚Äî Sentiment & Retenci√≥n
    function classifySentiment(subject, description) {
      const text = (subject + ' ' + description).toLowerCase();
      const angryTerms = ['estafa', 'inaceptable', 'enojado', 'molesto', 'furioso', 'devuelvan', 'qu√© mierda'];
      const frustratedTerms = ['frustrado', 'harto', 'otra vez', 'no me funciona', 'tarda', 'no llega'];
      const confusedTerms = ['no entiendo', 'duda', 'confundido', 'c√≥mo', 'por qu√©', 'no queda claro', 'se√±al'];
      const anxiousTerms = ['ansioso', 'ansiedad', 'nervioso', 'miedo', 'preocupado', 'perd√≠', 'perdido', 'racha'];
      if (angryTerms.some(w => text.includes(w)) || (text.includes('!!!'))) return 'angry';
      if (frustratedTerms.some(w => text.includes(w))) return 'frustrated';
      if (confusedTerms.some(w => text.includes(w))) return 'confused';
      if (anxiousTerms.some(w => text.includes(w))) return 'anxious';
      return 'normal';
    }
    function setInternalSentiment(sentiment) {
      const chip = document.getElementById('internalSentimentChip');
      const badge = document.getElementById('sentimentBadge');
      if (chip) { chip.style.display = 'inline-block'; chip.textContent = `Sentimiento: ${sentiment}`; }
      if (badge) { badge.textContent = sentiment; badge.className = `chip outline ${sentimentColor(sentiment)}`; }
    }
    function sentimentColor(s) {
      switch(s){
        case 'angry': return 'red';
        case 'frustrated': return 'orange';
        case 'confused': return 'indigo';
        case 'anxious': return 'yellow';
        default: return 'purple';
      }
    }
    function refreshUserSummary() {
      // Mock refresh
      document.getElementById('metric_roi7d')?.textContent = '-3.1%';
      document.getElementById('metric_picks')?.textContent = '27';
      document.getElementById('metric_streak')?.textContent = '-2';
      document.getElementById('metric_clv')?.textContent = '+0.04';
      document.getElementById('metric_markets')?.textContent = '1X2, Over/Under, AH';
      document.getElementById('metric_risk')?.textContent = '0.9% stake';
    }
    function createSystemTicket(type) {
      const inbox = document.querySelector('.inbox-list');
      if (!inbox) return;
      const item = document.createElement('div');
      item.className = 'conversation-item';
      item.dataset.tab = 'coaching';
      const map = {
        losing_streak: {
          title: 'Proactiva: Racha complicada',
          preview: 'Notamos una racha complicada. ¬øQuieres que revisemos juntos tu enfoque de mercado?'
        },
        inactivity: {
          title: 'Proactiva: Baja actividad',
          preview: 'Hace d√≠as no registras picks. ¬øTodo bien? Podemos ayudarte a reorganizar tu estrategia.'
        },
        ignoring_signals: {
          title: 'Proactiva: Dudas de ejecuci√≥n',
          preview: 'Est√°s siguiendo se√±ales pero no ejecutando. ¬øTe genera duda la entrada?'
        }
      };
      const cfg = map[type] || map.inactivity;
      item.innerHTML = `
        <div class="conversation-header">
          <div class="conversation-icon tipster">üéì</div>
          <div class="conversation-info">
            <div class="conversation-title">${cfg.title}</div>
            <div class="conversation-meta">
              <span>Ahora</span>
            </div>
          </div>
          <span class="chip ghost yellow">System</span>
        </div>
        <div class="conversation-preview">${cfg.preview}</div>
        <div class="conversation-chips">
          <div class="chip outline teal">Tipo: Coaching</div>
          <div class="chip ghost green">Churn Prevention</div>
        </div>
      `;
      inbox.prepend(item);
      // Cambiar a pesta√±a coaching autom√°ticamente
      const coachingTabBtn = document.querySelector(`.tab-btn[onclick="switchTab('coaching')"]`);
      coachingTabBtn?.click();
    }
    function triggerRiskGuardAutoMessage(reason) {
      showSystemNotice(`Tu actividad fue pausada temporalmente por protecci√≥n de banca. Motivo: ${reason}. Si quieres te explicamos el motivo.`);
    }

    // Resolve rating helpers
    function setRating(stars) {
      currentRating = stars;
      const container = document.getElementById('ratingStars');
      if (!container) return;
      container.querySelectorAll('span').forEach(span => {
        const val = Number(span.dataset.star);
        span.textContent = val <= stars ? '‚≠ê' : '‚òÜ';
      });
    }

    function submitResolutionRating() {
      const comment = document.getElementById('ratingComment')?.value || '';
      const rating = currentRating || 0;
      closeModal('resolveRatingModal');
      showSystemNotice(`Gracias por tu valoraci√≥n: ${rating ? '‚≠ê'.repeat(rating) : 'sin nota'}. ${comment ? 'Comentario: ' + comment : ''}`);
      const banner = document.querySelector('.ticket-resolved-banner');
      if (banner) banner.style.display = 'flex';
      const statusChip = document.querySelector('.chip.ghost.blue');
      if (statusChip) statusChip.textContent = 'Status: Resolved';
    }

    // Conversation selection
    document.querySelectorAll('.conversation-item').forEach(item => {
      item.addEventListener('click', function() {
        // Remove active from all
        document.querySelectorAll('.conversation-item').forEach(i => {
          i.classList.remove('active');
        });
        
        // Add active to clicked
        this.classList.add('active');
        
        // Remove unread badge
        const badge = this.querySelector('.unread-badge');
        if (badge) badge.remove();
        this.classList.remove('unread');

        // Toggle Tipster disclaimer and eligibility card (soft UI) + Coaching card
        const disclaimer = document.querySelector('.tipster-disclaimer');
        const eligibility = document.querySelector('.eligibility-card');
        const coachingCard = document.querySelector('.coaching-card');
        if (disclaimer) disclaimer.style.display = this.dataset.tab === 'tipsters' ? 'flex' : 'none';
        if (eligibility) eligibility.style.display = this.dataset.tab === 'tipsters' ? 'block' : 'none';
        if (coachingCard) coachingCard.style.display = this.dataset.tab === 'coaching' ? 'block' : 'none';

        // Update header chips and SLA banner
        updateConversationTypeAndSLA(this.dataset.tab);
        // Update inbox title on selection
        const title = this.dataset.tab === 'support' ? 'Tickets de Soporte' : (this.dataset.tab === 'tipsters' ? 'Chats con Tipsters' : 'Tu Entrenador de Trading');
        const inboxTitleEl = document.querySelector('.inbox-title');
        if (inboxTitleEl) inboxTitleEl.textContent = title;
      });
    });

    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.filter-btn').forEach(b => {
          b.classList.remove('active');
        });
        this.classList.add('active');
      });
    });

    // Message composer
    function handleComposerKeydown(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    function sendMessage() {
      const textarea = document.querySelector('.composer-textarea');
      const message = textarea.value.trim();
      if (!message) return;

      const nowTs = now();
      if (blockedUntilTs && nowTs < blockedUntilTs) {
        const remainingMin = minutes(blockedUntilTs - nowTs);
        showSystemNotice(`Bloqueo temporal autom√°tico por abuso. Vuelve en ~${remainingMin} min.`);
        return;
      }
      // Clean timestamps older than 60s
      messageTimestamps = messageTimestamps.filter(ts => nowTs - ts < 60000);
      if (messageTimestamps.length >= MESSAGE_LIMIT_PER_MIN) {
        rateLimitInfractions++;
        if (rateLimitInfractions >= ABUSE_INFRACTION_THRESHOLD) {
          blockedUntilTs = nowTs + TEMP_BLOCK_MINUTES * 60000;
          showSystemNotice(`Se activ√≥ un bloqueo temporal de ${TEMP_BLOCK_MINUTES} min por exceso de mensajes.`);
        } else {
          const nextWindowMs = 60000 - (nowTs - messageTimestamps[0]);
          const waitSec = Math.ceil(nextWindowMs / 1000);
          showSystemNotice(`Has alcanzado el l√≠mite de ${MESSAGE_LIMIT_PER_MIN} mensajes/min. Espera ~${waitSec}s.`);
        }
        return;
      }

      // Append user message
      const messagesContainer = document.querySelector('.chat-messages');
      const messageEl = document.createElement('div');
      messageEl.className = 'message user';
      messageEl.innerHTML = `
        <div class="message-avatar">TU</div>
        <div class="message-content">
          <div class="message-bubble">${message}</div>
          <div class="message-time">Ahora</div>
        </div>
      `;
      messagesContainer.appendChild(messageEl);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;

      messageTimestamps.push(nowTs);

      // Clear textarea
      textarea.value = '';
      textarea.style.height = 'auto';
    }

    // Auto-resize textarea
    document.querySelector('.composer-textarea')?.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 120) + 'px';
    });

    // Close modal on outside click
    document.getElementById('newTicketModal')?.addEventListener('click', function(e) {
      if (e.target === this) {
        closeNewTicketModal();
      }
    });

    console.log('Support Hub loaded');

    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }
    
    function toggleInternalNote() {
      const content = document.querySelector('.internal-note-content');
      const icon = document.querySelector('.internal-note-header svg');
      if (content.style.display === 'block') {
        content.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
      } else {
        content.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';
      }
    }

    // Funciones UI/UX detalladas en la documentaci√≥n
    function showEmptyState(type) {
      const container = document.querySelector('.conversations-list') || document.querySelector('.chat-messages');
      if (!container) return;
      
      const emptyStates = {
        noTickets: {
          icon: 'üé´',
          title: 'No tienes tickets abiertos',
          subtitle: '¬øNecesitas ayuda? Crea un nuevo ticket de soporte.',
          action: 'Crear Ticket',
          actionFn: 'openNewTicketModal()'
        },
        noMessages: {
          icon: 'üí¨',
          title: 'Sin mensajes a√∫n',
          subtitle: 'Escribe tu primer mensaje para iniciar la conversaci√≥n.',
          action: 'Escribir Mensaje',
          actionFn: 'focusComposer()'
        },
        noTipsters: {
          icon: 'üìä',
          title: 'A√∫n no sigues a ning√∫n tipster',
          subtitle: 'Explora nuestros tipsters y suscr√≠bete para chatear con ellos.',
          action: 'Explorar Tipsters',
          actionFn: 'window.location.href="/tipsters"'
        },
        noResults: {
          icon: 'üîç',
          title: 'No se encontraron resultados',
          subtitle: 'Intenta ajustar tus filtros o t√©rminos de b√∫squeda.',
          action: 'Limpiar Filtros',
          actionFn: 'clearFilters()'
        }
      };
      
      const state = emptyStates[type] || emptyStates.noMessages;
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">${state.icon}</div>
          <h3 class="empty-title">${state.title}</h3>
          <p class="empty-subtitle">${state.subtitle}</p>
          ${state.action ? `<button class="btn btn-primary" onclick="${state.actionFn}">${state.action}</button>` : ''}
        </div>
      `;
    }

    function renderContextChip(context) {
      const chips = {
        purchase: { text: 'Ver compra', icon: 'üîó', action: 'openPurchase' },
        withdraw: { text: 'Ver retiro', icon: 'üí∏', action: 'openWithdraw' },
        pick: { text: 'Ver pick', icon: 'üìà', action: 'openPick' },
        post: { text: 'Ver post', icon: 'üö®', action: 'openPost' },
        watchlist: { text: 'Ir a Watchlist', icon: 'üëÅÔ∏è', action: 'openWatchlist' },
        signal: { text: 'Abrir se√±al', icon: 'üì£', action: 'openSignal' }
      };
      
      const chip = chips[context];
      if (!chip) return '';
      
      return '<span class="context-chip" onclick="' + chip.action + '(\'' + context + '\')">' +
        '<span class="chip-icon">' + chip.icon + '</span>' +
        '<span class="chip-text">' + chip.text + '</span>' +
      '</span>';
    }

    function togglePolicyBanner() {
      const banner = document.querySelector('.policy-banner-fixed');
      if (!banner) return;
      
      const isVisible = banner.style.display !== 'none';
      banner.style.display = isVisible ? 'none' : 'block';
      
      // Actualizar bot√≥n
      const button = document.querySelector('.banner-toggle');
      if (button) {
        button.textContent = isVisible ? 'Ver pol√≠ticas' : 'Ocultar pol√≠ticas';
      }
      
      // Guardar preferencia
      localStorage.setItem('policyBannerVisible', !isVisible);
    }

    function showPolicyModal() {
      const modal = document.getElementById('policy-modal');
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }

    function closePolicyModal() {
      const modal = document.getElementById('policy-modal');
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

    // Initialize policy modal functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Add click event to policy banner button
      const policyButton = document.querySelector('.banner-toggle');
      if (policyButton) {
        policyButton.addEventListener('click', showPolicyModal);
      }

      // Add click event to close modal
      const closeModalButton = document.querySelector('.close-policy-modal');
      if (closeModalButton) {
        closeModalButton.addEventListener('click', closePolicyModal);
      }

      // Close modal when clicking outside
      const modal = document.getElementById('policy-modal');
      if (modal) {
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            closePolicyModal();
          }
        });
      }

      // Close modal with Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closePolicyModal();
        }
      });
    });

    function simulateActivity() {
      const indicator = document.querySelector('.activity-indicator');
      const messagesContainer = document.querySelector('.chat-messages');
      if (!indicator || !messagesContainer) return;
      
      // Mostrar indicador
      indicator.style.display = 'flex';
      indicator.innerHTML = `
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <span class="activity-text">Escribiendo...</span>
      `;
      
      // Simular respuesta despu√©s de 2-5 segundos
      const delay = Math.random() * 3000 + 2000;
      setTimeout(() => {
        indicator.style.display = 'none';
        
        // Agregar mensaje simulado
        const messageEl = document.createElement('div');
        messageEl.className = 'message admin';
        messageEl.innerHTML = `
          <div class="message-avatar">BOT</div>
          <div class="message-content">
            <div class="message-bubble">Gracias por tu mensaje. ¬øEn qu√© m√°s puedo ayudarte?</div>
            <div class="message-time">Ahora</div>
          </div>
        `;
        messagesContainer.appendChild(messageEl);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }, delay);
    }

    // Funciones auxiliares
    function focusComposer() {
      const textarea = document.querySelector('.composer-textarea');
      if (textarea) textarea.focus();
    }

    function clearFilters() {
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector('.search-input').value = '';
      // Recargar conversaciones
      showEmptyState('noTickets');
    }
  </script>
    <script>
      function switchTab(tabName) {
        // Switch active tab button
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.tab-btn[onclick="switchTab('${tabName}')"]`).classList.add('active');

        // Update inbox title
        const title = tabName === 'support' ? 'Tickets de Soporte' : (tabName === 'tipsters' ? 'Chats con Tipsters' : 'Tu Entrenador de Trading');
        document.querySelector('.inbox-title').textContent = title;

        // Show/hide conversations based on data-tab
        document.querySelectorAll('.conversation-item').forEach(item => {
          if (item.dataset.tab === tabName) {
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });
        
        // Show/hide filters
        const filters = document.querySelector('.inbox-filters');
        if (tabName === 'support') {
            filters.style.display = 'flex';
        } else {
            filters.style.display = 'none';
        }

        // Tipster disclaimer & eligibility (soft UI) + Coaching card
        const disclaimer = document.querySelector('.tipster-disclaimer');
        const eligibility = document.querySelector('.eligibility-card');
        const coachingCard = document.querySelector('.coaching-card');
        if (disclaimer) disclaimer.style.display = tabName === 'tipsters' ? 'flex' : 'none';
        if (eligibility) eligibility.style.display = tabName === 'tipsters' ? 'block' : 'none';
        if (coachingCard) coachingCard.style.display = tabName === 'coaching' ? 'block' : 'none';

        // Update header chips and SLA banner
        updateConversationTypeAndSLA(tabName);
      }
    </script>
  </body>
</html>
